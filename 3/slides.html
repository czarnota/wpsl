<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>presentation</title>
    <style>
    * { box-sizing: border-box; }
    .level2, h1 { max-height: 92vh; margin: 1em auto; background: #fff;
                  font-size: 12px; aspect-ratio: 16 / 9; padding: 1.5em;
                  display: flex; flex-direction: column; overflow: hidden;
                  flex: 1 1 auto; box-shadow: 0 0 0.5em #ddd; color: #333; }
    h1 { align-items: center; flex-direction: row; padding: 0.75em; margin: 0.5em auto;}
    body { margin: 0; padding: 0; font-family: sans-serif;
           background: rgb(237, 237, 240); font-size: 200px; }
    h2 { font-size: 2em; color: #005; padding: 0; }
    img { display: block; margin: auto; width: 100%; height: 100%;
          overflow: hidden; object-fit: contain;}
    section > p, section > ul { line-height: 1.5em; }
    ul { padding-left: 1em; }
    h2 { margin: 0 0 0.4em 0; }

    @page { size: 16in 9in; margin: 0; }
    @media print {
        body { -webkit-print-color-adjust: exact; }
        .level2, h1 { max-height: 100vh; margin: 0; }
    }

    .language-console .gp { color: #6ec071; }

    /*

        Name:       Base16 Tomorrow Dark
        Author:     Chris Kempson (http://chriskempson.com)

        Pygments template by Jan T. Sott (https://github.com/idleberg)
        Created with Base16 Builder by Chris Kempson (https://github.com/chriskempson/base16-builder)

    */
    .sourceCode .hll { background-color: #373b41; }
    .sourceCode { background: #1d1f21; color: #ffffff; }
    .sourceCode .co { color: #969896; } /* Comment */
    .sourceCode .err { color: #cc6666; }

    /* Error */
    .sourceCode .kw { color: #b294bb; } /* Keyword */
    .sourceCode .cf { color: #b294bb; } /* Keyword */
    .sourceCode .l { color: #de935f; }

    /* Literal */
    .sourceCode .n { color: #ffffff; }

    /* Name */
    .sourceCode .ot { color: #8abeb7; } /* Operator */
    .sourceCode .op { color: #8abeb7; } /* Operator */
    .sourceCode .p { color: #ffffff; }

    /* Punctuation */
    .sourceCode .cm { color: #969896; }

    /* Comment.Multiline */
    .sourceCode .pp { color: #69AE69; } /* Comment.Preproc */
    .sourceCode .im { color: #69AE69; } /* Comment.Preproc */
    .sourceCode .c1 { color: #969896; }

    /* Comment.Single */
    .sourceCode .cs { color: #969896; }

    /* Comment.Special */
    .sourceCode .gd { color: #cc6666; }

    /* Generic.Deleted */
    .sourceCode .ge { font-style: italic; }

    /* Generic.Emph */
    .sourceCode .gh { color: #ffffff; font-weight: bold; }

    /* Generic.Heading */
    .sourceCode .gi { color: #b5bd68; }

    /* Generic.Inserted */
    .sourceCode .gp { color: #969896; font-weight: bold; }

    /* Generic.Prompt */
    .sourceCode .gs { font-weight: bold; } 
    /* Generic.Strong */
    .sourceCode .gu { color: #8abeb7; font-weight: bold; }

    /* Generic.Subheading */
    .sourceCode .kc { color: #b294bb; }

    /* Keyword.Constant */
    .sourceCode .kd { color: #b294bb; }

    /* Keyword.Declaration */
    .sourceCode .kn { color: #8abeb7; }

    /* Keyword.Namespace */
    .sourceCode .kp { color: #b294bb; }

    /* Keyword.Pseudo */
    .sourceCode .kr { color: #b294bb; }

    /* Keyword.Reserved */
    .sourceCode .dt { color: #f0c674; } /* Keyword.Type */
    .sourceCode .ld { color: #b5bd68; }

    /* Literal.Date */
    .sourceCode .m { color: #de935f; }

    /* Literal.Number */
    .sourceCode .s { color: #b5bd68; }

    /* Literal.String */
    .sourceCode .na { color: #81a2be; }

    /* Name.Attribute */
    .sourceCode .bu { color: #ffffff; } /* Name.Builtin */
    .sourceCode .nc { color: #f0c674; }

    /* Name.Class */
    .sourceCode .no { color: #cc6666; }

    /* Name.Constant */
    .sourceCode .nd { color: #8abeb7; }

    /* Name.Decorator */
    .sourceCode .ni { color: #ffffff; }

    /* Name.Entity */
    .sourceCode .ne { color: #cc6666; }

    /* Name.Exception */
    .sourceCode .fu { color: #81a2be; } /* Name.Function */

    /* Name.Label */
    .sourceCode .nn { color: #f0c674; }

    /* Name.Namespace */
    .sourceCode .nx { color: #81a2be; }

    /* Name.Other */
    .sourceCode .py { color: #ffffff; }

    /* Name.Property */
    .sourceCode .nt { color: #8abeb7; }

    /* Name.Tag */
    .sourceCode .va { color: #cc6666; } /* Name.Variable */
    .sourceCode .ow { color: #8abeb7; }

    /* Operator.Word */
    .sourceCode .w { color: #ffffff; }

    /* Text.Whitespace */
    .sourceCode .mf { color: #de935f; }

    /* Literal.Number.Float */
    .sourceCode .mh { color: #de935f; }

    /* Literal.Number.Hex */
    .sourceCode .dv { color: #de935f; }

    /* Literal.Number.Integer */
    .sourceCode .mo { color: #de935f; }

    /* Literal.Number.Oct */
    .sourceCode .sb { color: #b5bd68; }

    /* Literal.String.Backtick */
    .sourceCode .sc { color: #ffffff; }

    /* Literal.String.Char */
    .sourceCode .sd { color: #969896; }

    /* x Literal.String.Doc */
    .sourceCode .st { color: #b5bd68; }

    /* Literal.String.Double */
    .sourceCode .sc { color: #de935f; } 
    /* Literal.String.Escape */
    .sourceCode .sh { color: #b5bd68; }

    /* Literal.String.Heredoc */
    .sourceCode .si { color: #de935f; }

    /* Literal.String.Interpol */
    .sourceCode .sx { color: #b5bd68; }

    /* Literal.String.Other */
    .sourceCode .sr { color: #b5bd68; }

    /* Literal.String.Regex */
    .sourceCode .s1 { color: #b5bd68; }

    /* Literal.String.Single */
    .sourceCode .ss { color: #b5bd68; }

    /* Literal.String.Symbol */
    .sourceCode .bp { color: #ffffff; }

    /* Name.Builtin.Pseudo */
    .sourceCode .vc { color: #cc6666; }

    /* Name.Variable.Class */
    .sourceCode .vg { color: #cc6666; }

    /* Name.Variable.Global */
    .sourceCode .vi { color: #cc6666; }

    /* Name.Variable.Instance */
    .sourceCode .il { color: #de935f; }

    /* Literal.Number.Integer.Long */

    div.sourceCode { vertical-align: top; }

    pre { font-family: monospace; font-size: 0.8em; }

    .sourceCode a { color: #fff }

    .sourceCode pre { padding: 0; margin: 0; }

    pre code { display: block; padding: 1em 1.25em; overflow-x: auto; background: #1d1f21; color: #ffffff; }

    .sourceCode pre code::-webkit-scrollbar { -webkit-appearance: none; }
    .sourceCode pre code::-webkit-scrollbar:vertical { width: 10px; }
    .sourceCode pre code::-webkit-scrollbar:horizontal { height: 10px; }
    .sourceCode pre code::-webkit-scrollbar-thumb { background-color: #555; }
    .sourceCode pre code::-webkit-scrollbar-track { background-color: #333; }
    .sourceCode::selection { background: #fff; /* WebKit/Blink Browsers */ color: #000; }
    .sourceCode::-moz-selection { background: #fff; /* Gecko Browsers */ color: #000; }
    p > code, li > code { background: #fff; padding: 0.1em 0.2em; box-shadow: 0 2px 4px 0 #ddd; border: 1px solid #ddd; }

    div.sourceCode, pre, section > p, section > ul { margin: 0 0 0.7em 0; }

    </style>
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
<section id="zagadnienie-3-obsługa-plików" class="level1">
<h1>Zagadnienie 3: Obsługa plików</h1>
<section id="komunikacja-międzyprocesowa" class="level2">
<h2>Komunikacja międzyprocesowa</h2>
<p>Metody komunikacji międzyprocesowej:</p>
<ul class="incremental">
<li>pliki</li>
<li>potoki nienazwane</li>
<li>potoki nazwane</li>
<li>semafory</li>
<li>pamięc współdzielona</li>
<li>sockety</li>
<li>kolejki komunikatów</li>
<li>sygnały</li>
</ul>
</section>
</section>
<section id="obsługa-plików---standard-c" class="level1">
<h1>Obsługa plików - standard C</h1>
<section id="obsługa-plików-według-standardu-języka-c" class="level2">
<h2>Obsługa plików według standardu języka C</h2>
<p>Biblioteka standardowa języka dostarcza funkcję do obsługi plików:</p>
<ul class="incremental">
<li><code>fopen()</code> - otwiera plik</li>
<li><code>fclose()</code> - zamyka plik</li>
<li><code>fread()</code> - odczytuje porcję danych z pliku</li>
<li><code>fwrite()</code> - wpisuje porcję danych do pliku</li>
</ul>
</section>
<section id="standard-c---otwieranie-pliku-do-odczytu" class="level2">
<h2>Standard C - otwieranie pliku do odczytu</h2>
<p>Do otwierenia pliku służy funkcja <code>fopen()</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@path:</span><span class="co"> ścieżka do pliku</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@mode:</span><span class="co"> tryb w jakim otwierany jest plik</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> *fopen(<span class="dt">const</span> <span class="dt">char</span> *path, <span class="dt">const</span> <span class="dt">char</span> *mode);</span></code></pre></div>
<p>Przykład:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> *file = fopen(<span class="st">&quot;plik.txt&quot;</span>, <span class="st">&quot;r&quot;</span>);</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (!file)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: can&#39;t open file</span><span class="sc">\n</span><span class="st">&quot;</span>);</span></code></pre></div>
</section>
<section id="standard-c---otwieranie-pliku-do-zapisu" class="level2">
<h2>Standard C - otwieranie pliku do zapisu</h2>
<p>Otwieranie pliku od zapisu:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> *file = fopen(<span class="st">&quot;plik.txt&quot;</span>, <span class="st">&quot;w&quot;</span>);</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (!file)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: can&#39;t open file</span><span class="sc">\n</span><span class="st">&quot;</span>);</span></code></pre></div>
<p>Otwieranie pliku do zapisu binarnego:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> *file = fopen(<span class="st">&quot;plik.txt&quot;</span>, <span class="st">&quot;wb&quot;</span>);</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (!file)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: can&#39;t open file</span><span class="sc">\n</span><span class="st">&quot;</span>);</span></code></pre></div>
<p>Jeśli plik nie istnieje - zostanie utworzony. Jeżeli plik istnieje jego zawartosć zostanie usunięta.</p>
</section>
<section id="standard-c---zamykanie-pliku" class="level2">
<h2>Standard C - zamykanie pliku</h2>
<p>Do zamykania pliku służy funkcja <code>fclose()</code></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="cv">:</span><span class="co"> wskaźnik do pliku</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fclose(<span class="dt">FILE</span> *file);</span></code></pre></div>
<p>Przykład:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>fclose(file);</span></code></pre></div>
</section>
<section id="standard-c---odczytywanie-danych-z-pliku" class="level2">
<h2>Standard C - odczytywanie danych z pliku</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@ptr:</span><span class="co"> wskaźnik do miejsca w pamięci gdzie mamy wczytać dane</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@size:</span><span class="co"> rozmiar elementu</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@nitems:</span><span class="co"> liczba elementów</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="cv">:</span><span class="co"> plik z którego odczytujemy</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> fread(<span class="dt">void</span> *ptr, <span class="dt">size_t</span> size, <span class="dt">size_t</span> nitems, <span class="dt">FILE</span> *file);</span></code></pre></div>
<p>Przykład - odczytanie z pliku do 32 bajtów:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> bytes[<span class="dv">32</span>];</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> count = fread(bytes, <span class="dv">1</span>, <span class="kw">sizeof</span>(bytes), file);</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count == <span class="dv">0</span>) {</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Koniec pliku */</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Plik <code>file</code> musi być otwarty do odczytu.</p>
</section>
<section id="standard-c---zapisanie-danych-do-pliku" class="level2">
<h2>Standard C - zapisanie danych do pliku</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@ptr:</span><span class="co"> wskaźnik do miejsca w pamięci z którego mamy zapisać dane</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@size:</span><span class="co"> rozmiar elementu</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@nitems:</span><span class="co"> liczba elementów</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@file</span><span class="cv">:</span><span class="co"> plik do którego zapisujemy</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> fwrite(<span class="dt">const</span> <span class="dt">void</span> *ptr, <span class="dt">size_t</span> size, <span class="dt">size_t</span> nitems, <span class="dt">FILE</span> *file);</span></code></pre></div>
<p>Przykład - zapisanie ciągu znaków <code>"Hello world"</code> w pliku:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> text[] = <span class="st">&quot;Hello world&quot;</span>;</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> count = fwrite(text, <span class="dv">1</span>, <span class="kw">sizeof</span>(text), file);</span></code></pre></div>
<p>Plik <code>file</code> musi być otwarty do zapisu.</p>
</section>
<section id="standard-c---sformatowany-zapis-i-odczyt" class="level2">
<h2>Standard C - sformatowany zapis i odczyt</h2>
<p>Na plikach możemy wywoływać funkcję analogiczne do <code>printf()</code> i <code>scanf()</code>, czyli <code>fprintf()</code> i <code>fscanf()</code>.</p>
<p>Przykład - funkcja <code>fscanf()</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> x, y, z;</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">3</span> != fscanf(file, <span class="st">&quot;%f %f %f&quot;</span>, &amp;x, &amp;y, &amp;z)) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Nie udało się odczytać */</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Przykład - funkcja <code>fprintf()</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">char</span> *name = <span class="st">&quot;Antoni&quot;</span>;</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>fprintf(file, <span class="st">&quot;Witaj %s</span><span class="sc">\n</span><span class="st">&quot;</span>, name);</span></code></pre></div>
</section>
<section id="standard-c---standardowe-wyjście-jest-plikiem" class="level2">
<h2>Standard C - standardowe wyjście jest plikiem</h2>
<p>Standardowe wyjście jest plikiem. Jest on otwarty pod zmienną globalną o nazwie <code>stdout</code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> text[] = <span class="st">&quot;Hello world&quot;</span>;</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>fwrite(text, <span class="dv">1</span>, <span class="kw">sizeof</span>(text), stdout);</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">char</span> *name = <span class="st">&quot;Antoni&quot;</span>;</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>fprintf(stdout, <span class="st">&quot;Witaj %s</span><span class="sc">\n</span><span class="st">&quot;</span>, name);</span></code></pre></div>
</section>
<section id="standard-c---standardowe-wejście-jest-plikiem" class="level2">
<h2>Standard C - standardowe wejście jest plikiem</h2>
<p>Standardowe wejście jest plikiem. Jest ono otwarte pod zmienną globalną o nazwie <code>stdin</code>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> number;</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="dv">1</span> != fscanf(stdin, <span class="st">&quot;%d&quot;</span>, &amp;number)) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Nie udało się odczytać */</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> bytes[<span class="dv">32</span>];</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> count = fread(bytes, <span class="dv">1</span>, <span class="kw">sizeof</span>(bytes), stdin);</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count == <span class="dv">0</span>) {</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Koniec pliku */</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="standard-c---standardowy-strumień-błędów-jest-plikiem" class="level2">
<h2>Standard C - standardowy strumień błędów jest plikiem</h2>
<p>Standardowy strumień błędów jest plikiem. Jest on otwarty pod zmienną globalną o nazwie <code>stderr</code>.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>fprintf(stderr, <span class="st">&quot;error: serious bug number %d</span><span class="sc">\n</span><span class="st">&quot;</span>, <span class="dv">123</span>);</span></code></pre></div>
</section>
<section id="przykład---zapisanie-standardowego-wejscia-do-pliku" class="level2">
<h2>Przykład - zapisanie standardowego wejscia do pliku</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> *file = fopen(<span class="st">&quot;out.txt&quot;</span>, <span class="st">&quot;wb&quot;</span>);</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (!file) {</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: failed to open file &#39;out.txt&#39;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">char</span> chunk[<span class="dv">128</span>];</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="dv">1</span>) {</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> count = fread(chunk, <span class="dv">1</span>, <span class="kw">sizeof</span>(chunk), stdin);</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!count)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>;</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    count = fwrite(chunk, <span class="dv">1</span>, <span class="kw">sizeof</span>(chunk), file);</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (count != <span class="kw">sizeof</span>(chunk))</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>;</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>fclose(file);</span></code></pre></div>
<pre><code>$ echo ten_tekst_bedzie_w_out.txt | ./program</code></pre>
</section>
<section id="przykład---zapisanie-2-zmiennych-do-pliku" class="level2">
<h2>Przykład - zapisanie 2 zmiennych do pliku</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> *file = fopen(<span class="st">&quot;out.txt&quot;</span>, <span class="st">&quot;wb&quot;</span>);</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (!file) {</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: failed to open file &#39;out.txt&#39;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a;</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> b;</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> count = fwrite(&amp;a, <span class="kw">sizeof</span>(a), <span class="dv">1</span>, file);</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count != <span class="dv">1</span>) {</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>    fclose(file);</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>count = fwrite(&amp;b, <span class="kw">sizeof</span>(b), <span class="dv">1</span>, file);</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count != <span class="dv">1</span>) {</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    fclose(file);</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>fclose(file);</span></code></pre></div>
</section>
<section id="przykład---odczytanie-2-zmiennych-z-pliku" class="level2">
<h2>Przykład - odczytanie 2 zmiennych z pliku</h2>
<div class="sourceCode" id="cb21"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="dt">FILE</span> *file = fopen(<span class="st">&quot;out.txt&quot;</span>, <span class="st">&quot;rb&quot;</span>);</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (!file) {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: failed to open file &#39;out.txt&#39;</span><span class="sc">\n</span><span class="st">&quot;</span>);</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a;</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> b;</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> count = fread(&amp;a, <span class="kw">sizeof</span>(a), <span class="dv">1</span>, file);</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count != <span class="dv">1</span>) {</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    fclose(file);</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>count = fread(&amp;b, <span class="kw">sizeof</span>(b), <span class="dv">1</span>, file);</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count != <span class="dv">1</span>) {</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>    fclose(file);</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>fclose(file);</span></code></pre></div>
</section>
</section>
<section id="obsługa-plików---wywołania-systemowe" class="level1">
<h1>Obsługa plików - wywołania systemowe</h1>
<section id="obsługa-plików-za-pomocą-wywołań-systemowych-posix" class="level2">
<h2>Obsługa plików za pomocą wywołań systemowych POSIX</h2>
<p>POSIX definiuje między innymi następujące wywołania systemowe do obsługi plików:</p>
<ul class="incremental">
<li><code>open()</code> - otwiera plik</li>
<li><code>close()</code> - zamyka plik</li>
<li><code>read()</code> - odczytuje porcję danych z pliku</li>
<li><code>write()</code> - wpisuje porcję danych do pliku</li>
</ul>
</section>
<section id="wywołania-systemowe---otwieranie-pliku-do-odczytu" class="level2">
<h2>Wywołania systemowe - otwieranie pliku do odczytu</h2>
<p>Do otwierenia pliku służy funkcja <code>open()</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@path:</span><span class="co"> ścieżka do pliku</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@oflag:</span><span class="co"> flagi określający tryb otwarcia pliku</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@mode:</span><span class="co"> uprawnienia do pliku - w przypadku tworzenia pliku</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> open(<span class="dt">const</span> <span class="dt">char</span> *path, <span class="dt">int</span> oflag);</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> open(<span class="dt">const</span> <span class="dt">char</span> *path, <span class="dt">int</span> oflag, mode_t mode);</span></code></pre></div>
<p>Przykład:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd = open(<span class="st">&quot;plik.txt&quot;</span>, O_RDONLY)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: can&#39;t open file</span><span class="sc">\n</span><span class="st">&quot;</span>);</span></code></pre></div>
</section>
<section id="wywołania-systemowe---otwieranie-pliku-do-zapisu" class="level2">
<h2>Wywołania systemowe - otwieranie pliku do zapisu</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd = open(<span class="st">&quot;plik.txt&quot;</span>, O_WRONLY | O_CREAT | O_TRUNC, <span class="bn">0644</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: can&#39;t open file</span><span class="sc">\n</span><span class="st">&quot;</span>);</span></code></pre></div>
<p>Jeżeli plik nie istnieje - zostanie utworzony. Jeżeli istnieje, jego zawartość zostanie usunięta.</p>
<p>Nie ma podziału na tryb binarny i tryb tekstowy. Jest tylko tryb binarny.</p>
</section>
<section id="wywołania-systemowe---zamykanie-pliku" class="level2">
<h2>Wywołania systemowe - zamykanie pliku</h2>
<p>Do zamykania pliku służy funkcja <code>close()</code></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@fd:</span><span class="co"> deskryptor pliku</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> close(<span class="dt">int</span> fd);</span></code></pre></div>
<p>Przykład:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>close(file_fd);</span></code></pre></div>
</section>
<section id="wywołania-systemowe---wczytywanie-danych-z-pliku" class="level2">
<h2>Wywołania systemowe - wczytywanie danych z pliku</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@fd:</span><span class="co"> deskryptor pliku</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@buf:</span><span class="co"> miejsce w pamięci gdzie zostaną zapisane dane z pliku</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@count:</span><span class="co"> liczba bajtów do odczytania</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> read(<span class="dt">int</span> fd, <span class="dt">void</span> *buf, <span class="dt">size_t</span> count);</span></code></pre></div>
<p>Przykład - odczytanie z pliku do 32 bajtów:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> bytes[<span class="dv">32</span>];</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> count = read(fd, bytes, <span class="kw">sizeof</span>(bytes));</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count == <span class="dv">0</span>) {</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Koniec pliku */</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count &lt; <span class="dv">0</span>) {</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Bląd odczytu */</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Plik <code>fd</code> musi być otwarty do odczytu.</p>
</section>
<section id="wywołania-systemowe---zapisywanie-danych-do-pliku" class="level2">
<h2>Wywołania systemowe - zapisywanie danych do pliku</h2>
<div class="sourceCode" id="cb29"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@fd:</span><span class="co"> deskryptor pliku</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@buf:</span><span class="co"> miejsce w pamięci z którego zostaną zapisane dane do pliku</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@count:</span><span class="co"> liczba bajtów do zapisu</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> write(<span class="dt">int</span> fd, <span class="dt">const</span> <span class="dt">void</span> *buf, <span class="dt">size_t</span> count);</span></code></pre></div>
<p>Przykład - zapisanie ciągu znaków <code>"Hello world"</code> w pliku</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> text[] = <span class="st">&quot;Hello world&quot;</span>;</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> count = write(fd, text, <span class="kw">sizeof</span>(text));</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count != <span class="kw">sizeof</span>(text)) {</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Nie wszystko się udało zapisać - błąd */</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="wywołanie-systemowe---standardowe-wyjście-jest-plikiem" class="level2">
<h2>Wywołanie systemowe - standardowe wyjście jest plikiem</h2>
<p>Standardowe wyjście jest plikiem. Jest ono otwarte pod deskryptorem <code>1</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> text[] = <span class="st">&quot;Hello world&quot;</span>;</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>write(<span class="dv">1</span>, text, <span class="kw">sizeof</span>(text));</span></code></pre></div>
</section>
<section id="wywołanie-systemowe---standardowe-wejście-jest-plikiem" class="level2">
<h2>Wywołanie systemowe - standardowe wejście jest plikiem</h2>
<p>Standardowe wejście jest plikiem. Jest ono otwarte pod deskryptorem <code>0</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> character;</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> ret = read(<span class="dv">0</span>, &amp;character, <span class="dv">1</span>);</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (ret &lt;= <span class="dv">0</span>) {</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Koniec wejścia albo błąd */</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</section>
<section id="wywołanie-systemowe---standardowy-strumień-błędów-jest-plikiem" class="level2">
<h2>Wywołanie systemowe - standardowy strumień błędów jest plikiem</h2>
<p>Standardowy strumień błędów jest plikiem. Jest on otwarty pod deskryptorem <code>2</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>write(<span class="dv">2</span>, <span class="st">&quot;error: successfully failed</span><span class="sc">\n</span><span class="st">&quot;</span>, strlen(<span class="st">&quot;error: successfully failed</span><span class="sc">\n</span><span class="st">&quot;</span>) + <span class="dv">1</span>);</span></code></pre></div>
</section>
<section id="przykład---zapisanie-standardowego-wejscia-do-pliku-1" class="level2">
<h2>Przykład - zapisanie standardowego wejscia do pliku</h2>
<div class="sourceCode" id="cb34"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd = open(<span class="st">&quot;out.txt&quot;</span>, O_CREATE | O_WRONLY | O_TRUNC, <span class="bn">0664</span>);</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (fd &lt; <span class="dv">0</span>) {</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: failed to open file &#39;out.txt&#39;&quot;</span>);</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">char</span> chunk[<span class="dv">128</span>];</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (<span class="dv">1</span>) {</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ssize_t</span> count = read(<span class="dv">0</span>, chunk, <span class="kw">sizeof</span>(chunk));</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (count &lt;= <span class="dv">0</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>;</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    count = write(fd, chunk, <span class="kw">sizeof</span>(chunk));</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (count != <span class="kw">sizeof</span>(chunk))</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span>;</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>close(file);</span></code></pre></div>
<pre><code>$ echo ten_tekst_bedzie_w_out.txt | ./program</code></pre>
</section>
<section id="przykład---zapisanie-2-zmiennych-do-pliku-1" class="level2">
<h2>Przykład - zapisanie 2 zmiennych do pliku</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd = open(<span class="st">&quot;out.txt&quot;</span>, O_CREAT | O_WRONLY | O_TRUC, <span class="bn">0664</span>);</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (fd &lt; <span class="dv">0</span>) {</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: failed to open file &#39;out.txt&#39;&quot;</span>);</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a;</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> b;</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> count = write(fd, &amp;a, <span class="kw">sizeof</span>(a));</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count != <span class="kw">sizeof</span>(a)) {</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    close(fd);</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>count = write(fd, &amp;b, <span class="kw">sizeof</span>(b));</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count != <span class="kw">sizeof</span>(a)) {</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    close(fd);</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>close(fd);</span></code></pre></div>
</section>
<section id="przykład---odczytanie-2-zmiennych-z-pliku-1" class="level2">
<h2>Przykład - odczytanie 2 zmiennych z pliku</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd = open(<span class="st">&quot;out.txt&quot;</span>, O_RDONLY);</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (!file) {</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    fprintf(stderr, <span class="st">&quot;err: failed to open file &#39;out.txt&#39;&quot;</span>);</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a;</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> b;</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> count = read(fd, &amp;a, <span class="kw">sizeof</span>(a));</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count != <span class="kw">sizeof</span>(a)) {</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    close(fd);</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>count = read(fd, &amp;b, <span class="kw">sizeof</span>(b));</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (count != <span class="kw">sizeof</span>(b)) {</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    close(fd);</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>close(fd);</span></code></pre></div>
</section>
<section id="endianowość" class="level2">
<h2>Endianowość</h2>
<p>Poprzednie 2 przykłady (zapis i odczyt zmiennych wielobajtowych z pliku) będą działać tylko i wyłącznie jeżeli plik jest zapisany i odczytany na maszynie z taką samą endianowością.</p>
<p>Jeżeli zapisujemy plik na maszynie z procesorem pracującym w trybie little endian (x86, ARM, …) i przeniesiemy go na inną maszyne z procesorem pracującym w trybie big endian (MIPS, ARM, …), i tam odczytamy, to kolejność bajtów się nie będzie zgadzać i dostaniemy inne wartości. Przykład:</p>
<pre><code>Liczba całkowita czterobajtowa 64048 = 0x0000FA30

Little endian:
+----+----+----+----+
| 30 | FA | 00 | 00 | ---- kierunek adresów ----&gt;
+----+----+----+----+

Big endian:
+----+----+----+----+
| 00 | 00 | FA | 30 | ---- kierunek adresów ----&gt;
+----+----+----+----+</code></pre>
</section>
<section id="jak-radzić-sobie-z-endianowością" class="level2">
<h2>Jak radzić sobie z endianowością?</h2>
<p>Z endianowością można poradzić sobie:</p>
<ul class="incremental">
<li>Zapisując dane po prostu jako tekst.</li>
<li>Zamieniając kolejność bajtów na jedną ustaloną endianowość (np. Big Endian) i zapisując ją w ten sposób do pliku. Następnie wykonywać operację odwrotną przy odczytywaniu - jeżeli jesteśmy na innej endianowości.</li>
</ul>
<p>Nagłówek <code>&lt;arpa/inet.h&gt;</code> definiuje funkcje pozwalające zamienić endianowość liczby.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> htonl(<span class="dt">uint32_t</span> hostlong);</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="dt">uint16_t</span> htons(<span class="dt">uint16_t</span> hostshort);</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> ntohl(<span class="dt">uint32_t</span> netlong);</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="dt">uint16_t</span> ntohs(<span class="dt">uint16_t</span> netshort);</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> n_host_endian = <span class="bn">0xFA30</span>;</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="dt">uint32_t</span> big_endian = htonl(n_host_endian);</span></code></pre></div>
</section>
</section>
<section id="dziękuję-za-uwagę" class="level1">
<h1>Dziękuję za uwagę</h1>
</section>
  <script>
    /*!	
    * FitText.js 1.0 jQuery free version
    *
    * Copyright 2011, Dave Rupert http://daverupert.com 
    * Released under the WTFPL license 
    * http://sam.zoy.org/wtfpl/
    * Modified by Slawomir Kolodziej http://slawekk.info
    *
    * Date: Tue Aug 09 2011 10:45:54 GMT+0200 (CEST)
    */
    (function(){

      var addEvent = function (el, type, fn) {
        if (el.addEventListener)
          el.addEventListener(type, fn, false);
            else
                el.attachEvent('on'+type, fn);
      };
      
      var extend = function(obj,ext){
        for(var key in ext)
          if(ext.hasOwnProperty(key))
            obj[key] = ext[key];
        return obj;
      };

      window.fitText = function (el, kompressor, options) {

        var settings = extend({
          'minFontSize' : -1/0,
          'maxFontSize' : 1/0
        },options);

        var fit = function (el) {
          var compressor = kompressor || 1;

          var resizer = function () {
            el.style.fontSize = Math.max(Math.min(el.clientWidth / (compressor*10), parseFloat(settings.maxFontSize)), parseFloat(settings.minFontSize)) + 'px';
          };

          // Call once to set.
          resizer();

          // Bind events
          // If you have any js library which support Events, replace this part
          // and remove addEvent function (or use original jQuery version)
          addEvent(window, 'resize', resizer);
          addEvent(window, 'orientationchange', resizer);
        };

        if (el.length)
          for(var i=0; i<el.length; i++)
            fit(el[i]);
        else
          fit(el);

        // return set of elements
        return el;
      };
    })();

    fitText(document.querySelectorAll('.level2'), 5);
    fitText(document.querySelectorAll('h1'), 2.5);

    document.querySelectorAll('p > img').forEach(e => e.parentNode.style.overflow="hidden");

  </script>
  </body>
</html>
