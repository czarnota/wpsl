<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Komunikacja sieciowa</title>
    <style>
    html { -moz-text-size-adjust: none; -webkit-text-size-adjust: none; text-size-adjust: none; }
    * { box-sizing: border-box; }
    .level2, h1 { max-height: 92vh; margin: 1em auto; background: #fff;
                  font-size: 12px; aspect-ratio: 16 / 9; padding: 1.5em;
                  display: flex; flex-direction: column; overflow: hidden;
                  flex: 1 1 auto; box-shadow: 0 0 0.5em #ddd; color: #333; }
    h1 { align-items: center; flex-direction: row; padding: 0.75em; margin: 0.5em auto;}
    body { margin: 0; padding: 0; font-family: Helvetica, sans-serif;
           background: rgb(237, 237, 240); font-size: 200px; }
    h2 { font-size: 2em; color: #005; padding: 0; }
    img { display: block; margin: auto; width: 100%; height: 100%;
          overflow: hidden; object-fit: contain;}
    section > p, section > ul { line-height: 1.5em; }
    ul { padding-left: 1em; }
    h2 { margin: 0 0 0.4em 0; }
    pre { line-height: 1.125em; }

    @page { size: 16in 9in; margin: 0; }
    @media print {
        body { -webkit-print-color-adjust: exact; }
        .level2, h1 { max-height: 100vh; margin: 0; }
    }

    .language-console .gp { color: #6ec071; }
    .sourceCode.diff .st { color: #cc6666; }
    .sourceCode.diff .va { color: #b5bd68; }

    /*

        Name:       Base16 Tomorrow Dark
        Author:     Chris Kempson (http://chriskempson.com)

        Pygments template by Jan T. Sott (https://github.com/idleberg)
        Created with Base16 Builder by Chris Kempson (https://github.com/chriskempson/base16-builder)

    */
    .sourceCode .hll { background-color: #373b41; }
    .sourceCode { background: #1d1f21; color: #ffffff; }
    .sourceCode .co { color: #969896; } /* Comment */
    .sourceCode .err { color: #cc6666; }

    /* Error */
    .sourceCode .kw { color: #b294bb; } /* Keyword */
    .sourceCode .cf { color: #b294bb; } /* Keyword */
    .sourceCode .l { color: #de935f; }

    /* Literal */
    .sourceCode .n { color: #ffffff; }

    /* Name */
    .sourceCode .ot { color: #8abeb7; } /* Operator */
    .sourceCode .op { color: #8abeb7; } /* Operator */
    .sourceCode .p { color: #ffffff; }

    /* Punctuation */
    .sourceCode .cm { color: #969896; }

    /* Comment.Multiline */
    .sourceCode .pp { color: #69AE69; } /* Comment.Preproc */
    .sourceCode .im { color: #69AE69; } /* Comment.Preproc */
    .sourceCode .c1 { color: #969896; }

    /* Comment.Single */
    .sourceCode .cs { color: #969896; }

    /* Comment.Special */
    .sourceCode .gd { color: #cc6666; }

    /* Generic.Deleted */
    .sourceCode .ge { font-style: italic; }

    /* Generic.Emph */
    .sourceCode .gh { color: #ffffff; font-weight: bold; }

    /* Generic.Heading */
    .sourceCode .gi { color: #b5bd68; }

    /* Generic.Inserted */
    .sourceCode .gp { color: #969896; font-weight: bold; }

    /* Generic.Prompt */
    .sourceCode .gs { font-weight: bold; } 
    /* Generic.Strong */
    .sourceCode .gu { color: #8abeb7; font-weight: bold; }

    /* Generic.Subheading */
    .sourceCode .kc { color: #b294bb; }

    /* Keyword.Constant */
    .sourceCode .kd { color: #b294bb; }

    /* Keyword.Declaration */
    .sourceCode .kn { color: #8abeb7; }

    /* Keyword.Namespace */
    .sourceCode .kp { color: #b294bb; }

    /* Keyword.Pseudo */
    .sourceCode .kr { color: #b294bb; }

    /* Keyword.Reserved */
    .sourceCode .dt { color: #f0c674; } /* Keyword.Type */
    .sourceCode .ld { color: #b5bd68; }

    /* Literal.Date */
    .sourceCode .m { color: #de935f; }

    /* Literal.Number */
    .sourceCode .s { color: #b5bd68; }

    /* Literal.String */
    .sourceCode .na { color: #81a2be; }

    /* Name.Attribute */
    .sourceCode .bu { color: #ffffff; } /* Name.Builtin */
    .sourceCode .nc { color: #f0c674; }

    /* Name.Class */
    .sourceCode .no { color: #cc6666; }

    /* Name.Constant */
    .sourceCode .nd { color: #8abeb7; }

    /* Name.Decorator */
    .sourceCode .ni { color: #ffffff; }

    /* Name.Entity */
    .sourceCode .ne { color: #cc6666; }

    /* Name.Exception */
    .sourceCode .fu { color: #81a2be; } /* Name.Function */

    /* Name.Label */
    .sourceCode .nn { color: #f0c674; }

    /* Name.Namespace */
    .sourceCode .nx { color: #81a2be; }

    /* Name.Other */
    .sourceCode .py { color: #ffffff; }

    /* Name.Property */
    .sourceCode .nt { color: #8abeb7; }

    /* Name.Tag */
    .sourceCode .va { color: #cc6666; } /* Name.Variable */
    .sourceCode .ow { color: #8abeb7; }

    /* Operator.Word */
    .sourceCode .w { color: #ffffff; }

    /* Text.Whitespace */
    .sourceCode .mf { color: #de935f; }

    /* Literal.Number.Float */
    .sourceCode .mh { color: #de935f; }

    /* Literal.Number.Hex */
    .sourceCode .dv { color: #de935f; }

    /* Literal.Number.Integer */
    .sourceCode .mo { color: #de935f; }

    /* Literal.Number.Oct */
    .sourceCode .sb { color: #b5bd68; }

    /* Literal.String.Backtick */
    .sourceCode .sc { color: #ffffff; }

    /* Literal.String.Char */
    .sourceCode .sd { color: #969896; }

    /* x Literal.String.Doc */
    .sourceCode .st { color: #b5bd68; }

    /* Literal.String.Double */
    .sourceCode .sc { color: #de935f; } 
    /* Literal.String.Escape */
    .sourceCode .sh { color: #b5bd68; }

    /* Literal.String.Heredoc */
    .sourceCode .si { color: #de935f; }

    /* Literal.String.Interpol */
    .sourceCode .sx { color: #b5bd68; }

    /* Literal.String.Other */
    .sourceCode .sr { color: #b5bd68; }

    /* Literal.String.Regex */
    .sourceCode .s1 { color: #b5bd68; }

    /* Literal.String.Single */
    .sourceCode .ss { color: #b5bd68; }

    /* Literal.String.Symbol */
    .sourceCode .bp { color: #ffffff; }

    /* Name.Builtin.Pseudo */
    .sourceCode .vc { color: #cc6666; }

    /* Name.Variable.Class */
    .sourceCode .vg { color: #cc6666; }

    /* Name.Variable.Global */
    .sourceCode .vi { color: #cc6666; }

    /* Name.Variable.Instance */
    .sourceCode .il { color: #de935f; }

    /* Literal.Number.Integer.Long */

    div.sourceCode { vertical-align: top; }

    pre { font-family: monospace; font-size: 0.8em; }

    .sourceCode a { color: #fff }

    .sourceCode pre { padding: 0; margin: 0; }

    pre code { display: block; padding: 1em 1.25em; overflow-x: auto; background: #1d1f21; color: #ffffff; }

    .sourceCode pre code::-webkit-scrollbar { -webkit-appearance: none; }
    .sourceCode pre code::-webkit-scrollbar:vertical { width: 10px; }
    .sourceCode pre code::-webkit-scrollbar:horizontal { height: 10px; }
    .sourceCode pre code::-webkit-scrollbar-thumb { background-color: #555; }
    .sourceCode pre code::-webkit-scrollbar-track { background-color: #333; }
    .sourceCode::selection { background: #fff; /* WebKit/Blink Browsers */ color: #000; }
    .sourceCode::-moz-selection { background: #fff; /* Gecko Browsers */ color: #000; }
    p > code, li > code { background: #fff; padding: 0.1em 0.2em; box-shadow: 0 2px 4px 0 #ddd; border: 1px solid #ddd; }

    div.sourceCode, pre, section > p, section > ul { margin: 0 0 0.7em 0; }

    </style>
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
<section id="zagadnienie-4-komunikacja-sieciowa" class="level1">
<h1>Zagadnienie 4: Komunikacja sieciowa</h1>
<section id="informacje-wstępne---tablice" class="level2">
<h2>Informacje wstępne - tablice</h2>
<p>Tablicą nazwywamy ciąg elementów takiego samego typu.</p>
<p>Przykłady tablic:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> numbers<span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">1.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">2.0</span><span class="bu">f</span><span class="op">,</span> <span class="op">-</span><span class="fl">3.0</span><span class="bu">f</span><span class="op">};</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">10</span><span class="op">};</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> name<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span> <span class="ch">&#39;S&#39;</span><span class="op">,</span> <span class="ch">&#39;t&#39;</span><span class="op">,</span> <span class="ch">&#39;e&#39;</span><span class="op">,</span> <span class="ch">&#39;f&#39;</span><span class="op">,</span> <span class="ch">&#39;a&#39;</span><span class="op">,</span> <span class="ch">&#39;n&#39;</span><span class="op">,</span> <span class="dv">0</span> <span class="op">};</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> name2<span class="op">[]</span> <span class="op">=</span> <span class="st">&quot;Stefan&quot;</span><span class="op">;</span></span></code></pre></div>
<p>Elementy tablicy są ułożone pod kolejnymi adresami w pamięci:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> values<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span></code></pre></div>
<pre><code>0x4 0x8 0xb
  +---+---+---+
  | 1 | 2 | 3 |
  +---+---+---+</code></pre>
</section>
<section id="informacje-wstępne---nazwa-tablicy-jest-wskaźnikiem-do-pierwszego-elementu" class="level2">
<h2>Informacje wstępne - nazwa tablicy jest wskaźnikiem do pierwszego elementu</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> values<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> values<span class="op">;</span></span></code></pre></div>
<pre><code>0x4 0x8 0xb             p
  +---+---+---+          +---+
  | 1 | 2 | 3 |          |0x4|
  +---+---+---+          +---+
  ^------------------------&#39;</code></pre>
</section>
<section id="informacje-wstępne---struktury" class="level2">
<h2>Informacje wstępne - struktury</h2>
<p>O ile tablice reprezentowały ciąg elementów takiego samego typu, to struktury reprezentują zbiór elementów o możliwie różnych typach.</p>
<p>Definicja struktury:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> person <span class="op">{</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> age<span class="op">;</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> salary<span class="op">;</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">16</span><span class="op">];</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Utworzenie obiektu struktury i wypełnienie pól:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> person p<span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>age <span class="op">=</span> <span class="dv">46</span><span class="op">;</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>p<span class="op">.</span>salary <span class="op">=</span> <span class="fl">1029384732.0</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>snprintf<span class="op">(</span>p<span class="op">.</span>name<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>p<span class="op">.</span>name<span class="op">),</span> <span class="st">&quot;</span><span class="sc">%s</span><span class="st">&quot;</span><span class="op">,</span> <span class="st">&quot;Daniel&quot;</span><span class="op">);</span></span></code></pre></div>
</section>
<section id="informacje-wstępne---struktury---inicjalizacja" class="level2">
<h2>Informacje wstępne - struktury - inicjalizacja</h2>
<p>Strukturę można zainicjalizować podając kolejno jej elementy.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> person p <span class="op">=</span> <span class="op">{</span> <span class="dv">46</span><span class="op">,</span> <span class="fl">1029384732.0</span><span class="bu">f</span><span class="op">,</span> <span class="st">&quot;Daniel&quot;</span> <span class="op">};</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">/* Rekomendowaną praktyką jest stosowanie &quot;designated initializers&quot; z C99 */</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> person p2 <span class="op">=</span> <span class="op">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>age <span class="op">=</span> <span class="dv">46</span><span class="op">,</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>salary <span class="op">=</span> <span class="fl">1029384732.0</span><span class="bu">f</span><span class="op">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;Daniel&quot;</span><span class="op">,</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Pola pominięte bedą zainicjalizowane zerami */</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Inicjalizacja struktury samymi zerami:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> person p <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span></code></pre></div>
</section>
<section id="informacje-wstępne---struktury-układ-w-pamięci" class="level2">
<h2>Informacje wstępne - struktury układ w pamięci</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> a<span class="op">;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> b<span class="op">;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c<span class="op">;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Jeżeli kompilujemy program na architekturę, gdzie <code>sizeof(int) == 4</code>, to wtedy struktura może wyglądać w pamięci następujący sposób:</p>
<pre><code>+---+---+---+---+---+---+---+---+---+
| a |       b       |       c       |
+---+---+---+---+---+---+---+---+---+</code></pre>
<p><strong>Czy aby na pewno?</strong></p>
</section>
<section id="informacje-wstępne---padding" class="level2">
<h2>Informacje wstępne - padding</h2>
<p>Niestety, w praktyce najprawdopodobniej kompilator wyrówna pola struktury tak aby adresy były podzielne np. przez 4, ponieważ w ten sposób procesor może je szybciej zaadresować:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> a<span class="op">;</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> b<span class="op">;</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c<span class="op">;</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<pre><code>+---+---+---+---+---+---+---+---+---+---+---+---+
| a |  padding  |       b       |       c       |
+---+---+---+---+---+---+---+---+---+---+---+---+</code></pre>
<p>Wartość <code>sizeof(struct foo)</code> najprawdopodobniej wyniesie <code>12</code>, a nie <code>9</code>.</p>
<p><strong>Jak pozbyć się/ograniczyć padding?</strong></p>
</section>
<section id="informacje-wstępne---ograniczenie-paddingu" class="level2">
<h2>Informacje wstępne - ograniczenie paddingu</h2>
<p>Padding można ograniczyć zamieniając kolejność pól. Optymalizując struktury w ten sposób, można zaoszczędzić pamięć.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> b<span class="op">;</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c<span class="op">;</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> a<span class="op">;</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<pre><code>+---+---+---+---+---+---+---+---+---+
|       b       |       c       | a |
+---+---+---+---+---+---+---+---+---+</code></pre>
<p>Alternatywnie, kompilatory oferują <strong>niestandardowe</strong> rozszerzenia umożliwiające wyłączenie paddingu: <code>#pragma pack</code> w MSVC i <code>__attribute__((packed))</code> w <code>gcc</code>.</p>
</section>
<section id="informacje-wstępne---operacje-na-strukturach" class="level2">
<h2>Informacje wstępne - operacje na strukturach</h2>
<p>Struktury obsługują operator przypisania <code>=</code>, który powoduje przekopiowanie wartości każdego pola.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> vec2 <span class="op">{</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> x<span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> y<span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> vec2 position_a <span class="op">=</span> <span class="op">{</span> <span class="fl">2.0</span><span class="bu">f</span><span class="op">,</span> <span class="fl">10.0</span><span class="bu">f</span> <span class="op">};</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> vec2 position_b <span class="op">=</span> position_a<span class="op">;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%f</span><span class="st"> </span><span class="sc">%f</span><span class="st">&quot;</span><span class="op">,</span> position_b<span class="op">.</span>x<span class="op">,</span> position_b<span class="op">.</span>y<span class="op">);</span></span></code></pre></div>
</section>
<section id="informacje-wstępne---definicja-i-utworzenie-obiektu-w-jednym" class="level2">
<h2>Informacje wstępne - definicja i utworzenie obiektu w jednym</h2>
<p>Strukturę możemy zdefiniować i od razu utworzyć zmienną jej typu:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> player_config <span class="op">{</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> vec2 velocity<span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">32</span><span class="op">];</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> max_hp<span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> configuration <span class="op">=</span> <span class="op">{</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>velocity <span class="op">=</span> <span class="op">{</span> <span class="dv">0</span><span class="er">.0f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span> <span class="op">},</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;Marian&quot;</span><span class="op">,</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>max_hp <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st">&quot;</span><span class="op">,</span> configuration<span class="op">.</span>name<span class="op">);</span></span></code></pre></div>
</section>
<section id="informacje-wstępne---anonimowe-struktury" class="level2">
<h2>Informacje wstępne - anonimowe struktury</h2>
<p>Gdy od razu tworzymy zmienną możemy pominąć nazwę typu:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> vec2 velocity<span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">32</span><span class="op">];</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> max_hp<span class="op">;</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> configuration <span class="op">=</span> <span class="op">{</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>velocity <span class="op">=</span> <span class="op">{</span> <span class="dv">0</span><span class="er">.0f</span><span class="op">,</span> <span class="fl">1.0</span><span class="bu">f</span> <span class="op">},</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;Marian&quot;</span><span class="op">,</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>max_hp <span class="op">=</span> <span class="dv">200</span><span class="op">,</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st">&quot;</span><span class="op">,</span> configuration<span class="op">.</span>name<span class="op">);</span></span></code></pre></div>
</section>
<section id="informacje-wstępne---tablice-struktur" class="level2">
<h2>Informacje wstępne - tablice struktur</h2>
<p>Nic nie stoi na przeszkodzie aby łączyć tablice i struktury:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> month_info <span class="op">{</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> number<span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> days<span class="op">;</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">32</span><span class="op">];</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> month_info months<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">31</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;January&quot;</span> <span class="op">},</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">28</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;February&quot;</span> <span class="op">},</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">31</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;March&quot;</span> <span class="op">},</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">4</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;April&quot;</span> <span class="op">},</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">5</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">31</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;May&quot;</span> <span class="op">},</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">6</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;June&quot;</span> <span class="op">},</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">7</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">31</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;July&quot;</span> <span class="op">},</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">8</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">31</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;August&quot;</span> <span class="op">},</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">9</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;September&quot;</span> <span class="op">},</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">31</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;October&quot;</span> <span class="op">},</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">11</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">30</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;November&quot;</span> <span class="op">},</span></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span> <span class="op">.</span>number <span class="op">=</span> <span class="dv">12</span><span class="op">,</span> <span class="op">.</span>days <span class="op">=</span> <span class="dv">31</span><span class="op">,</span> <span class="op">.</span>name <span class="op">=</span> <span class="st">&quot;December&quot;</span> <span class="op">},</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
</section>
<section id="informacje-wstępne---wskaźniki-na-struktury" class="level2">
<h2>Informacje wstępne - wskaźniki na struktury</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span> <span class="dt">int</span> a<span class="op">;</span> <span class="op">};</span></span></code></pre></div>
<p>Do pól struktury odnosimy się używając operatora <code>.</code>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo foo <span class="op">=</span> <span class="op">{</span> <span class="dv">1</span> <span class="op">}:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> foo<span class="op">.</span>a<span class="op">);</span></span></code></pre></div>
<p>Do pól struktury poprzez wskaźnik odnosimy się używając operatora <code>-&gt;</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo foo <span class="op">=</span> <span class="op">{</span> <span class="dv">1</span> <span class="op">};</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">*</span>bar <span class="op">=</span> <span class="op">&amp;</span>foo<span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> bar<span class="op">-&gt;</span>a<span class="op">);</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%d\n</span><span class="st">&quot;</span><span class="op">,</span> <span class="op">(*</span>bar<span class="op">).</span>a<span class="op">);</span></span></code></pre></div>
</section>
<section id="informacje-wstępne---lista-jednokierunkowa" class="level2">
<h2>Informacje wstępne - lista jednokierunkowa</h2>
<p>Lista jednokierunkowa, podobnie jak tablica pozwala na utworzenie kolekcji elementów takiego samego typu - z tą różnicą że elementy nie będą ułożone kolejno w pamięci.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> book <span class="op">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Wskaźnik do następnego elementu */</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> book <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> title<span class="op">[</span><span class="dv">128</span><span class="op">];</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> book book1 <span class="op">=</span> <span class="op">{</span> <span class="op">.</span>next <span class="op">=</span> NULL<span class="op">,</span> <span class="op">.</span>title <span class="op">=</span> <span class="st">&quot;Harry Potter i Tablica Charów&quot;</span> <span class="op">};</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> book book2 <span class="op">=</span> <span class="op">{</span> <span class="op">.</span>next <span class="op">=</span> <span class="op">&amp;</span>book1<span class="op">,</span> <span class="op">.</span>title <span class="op">=</span> <span class="st">&quot;Harry Router i Maska Podsieci&quot;</span> <span class="op">};</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> book book3 <span class="op">=</span> <span class="op">{</span> <span class="op">.</span>next <span class="op">=</span> <span class="op">&amp;</span>book2<span class="op">,</span> <span class="op">.</span>title <span class="op">=</span> <span class="st">&quot;Alicja na Wydziale Informatyki&quot;</span> <span class="op">};</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="kw">struct</span> book <span class="op">*</span>book <span class="op">=</span> <span class="op">&amp;</span>book3<span class="op">;</span> book <span class="op">!=</span> NULL<span class="op">;</span> book <span class="op">=</span> book<span class="op">-&gt;</span>next<span class="op">)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;tytul: </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> book<span class="op">-&gt;</span>title<span class="op">);</span></span></code></pre></div>
</section>
</section>
<section id="protokół-http" class="level1">
<h1>Protokół HTTP</h1>
<section id="każda-strona-internetowa-to-dokument-hipertekstowy" class="level2">
<h2>Każda strona internetowa to dokument hipertekstowy</h2>
<p><img src="assets/onet.png" /></p>
</section>
<section id="hipertekstowy-język-znaczników-html" class="level2">
<h2>Hipertekstowy język znaczników (HTML)</h2>
<p>Język HTML, służy do formułowania dokumentów hipertekstowych, które następnie są prezentowane przez przeglądarke jako strona internetowa.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html</span> <span class="er">lang</span><span class="ot">=</span><span class="st">&quot;pl&quot;</span><span class="kw">&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;head&gt;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span> <span class="er">charset</span><span class="ot">=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span> <span class="er">http-equiv</span><span class="ot">=</span><span class="st">&quot;X-UA-Compatible&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;IE=edge&quot;</span><span class="kw">&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span> <span class="er">name</span><span class="ot">=</span><span class="st">&quot;viewport&quot;</span> <span class="er">content</span><span class="ot">=</span><span class="st">&quot;width=device-width, initial-scale=1&quot;</span><span class="kw">&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;title&gt;</span>Title<span class="kw">&lt;/title&gt;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/head&gt;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;body&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;h1&gt;</span>Witaj świecie<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;p&gt;</span>Oto pierwszy akapit<span class="kw">&lt;/p&gt;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/body&gt;</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div>
</section>
<section id="hipertekstowy-język-znaczników---efekt" class="level2">
<h2>Hipertekstowy język znaczników - efekt</h2>
<p>Po wyrenderowaniu HTML, przez przeglądarke otrzymujemy następujący efekt:</p>
<p><img src="assets/htmlhello.png" /></p>
</section>
<section id="protokół-przesyłania-dokumentów-hipertekstowych-http" class="level2">
<h2>Protokół przesyłania dokumentów hipertekstowych (HTTP)</h2>
<p>Do przesyłania dokumentów HTML poprzez sieć służy protokół HTTP. Gdy użytkownik chce wejśc na daną stronę internetową, to przeglądarka wysyła żądanie HTTP do serwera HTTP. Następnie serwer odsyła przeglądarce odpowiedź.</p>
<p><img src="assets/http.svg" /></p>
</section>
<section id="żądanie-http" class="level2">
<h2>Żądanie HTTP</h2>
<p>Żądanie HTTP ma format tekstowy. Składa się z nagłówków zapytania oraz opcjonalnego ciała.</p>
<pre><code>METODA ZASÓB WERSJA_HTTP
Nagłówek1: Wartość1
Nagłówek2: Wartość2

&lt;opcjonalne ciało&gt;</code></pre>
<p>Przykład:</p>
<pre><code>GET /index.html HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:98.0) Gecko/20100101 Firefox/98.0
Accept: */*

</code></pre>
<p>W <code>HTTP/1.1</code> wymaganym nagłówkiem jest <code>Host</code>, reszta jest opcjonalna.</p>
</section>
<section id="odpowiedź-http" class="level2">
<h2>Odpowiedź HTTP</h2>
<p>Odpowiedź HTTP ma format tekstowy. Składa się z linii statusu, nagłówków zapytania oraz opcjonalnego ciała:</p>
<pre><code>HTTP/1.1 KOD_ODPOWIEDZI NAZWA_KODU
Nagłówek1: Wartość1
Nagłówek2: Wartość2

&lt;opcjonalne ciało&gt;</code></pre>
</section>
<section id="odpowiedź-http---przykład" class="level2">
<h2>Odpowiedź HTTP - przykład</h2>
<p>Przykładowa odpowiedź HTTP:</p>
<pre><code>HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Date: Thu, 07 Apr 2022 15:32:42 GMT
Content-Length: 353

&lt;!doctype html&gt;
&lt;html lang=&quot;pl&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
        &lt;title&gt;Title&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Witaj świecie&lt;/h1&gt;
        &lt;p&gt;Oto pierwszy akapit&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</section>
</section>
<section id="droga-pakietu-w-sieci" class="level1">
<h1>Droga pakietu w sieci</h1>
<section id="droga-pakietu---wysłanie-pakietu" class="level2">
<h2>Droga pakietu - wysłanie pakietu</h2>
<p><img src="assets/5.anim.svg" /></p>
</section>
<section id="droga-pakietu---switch" class="level2">
<h2>Droga pakietu - switch</h2>
<p><img src="assets/6.anim.svg" /></p>
</section>
<section id="droga-pakietu---router" class="level2">
<h2>Droga pakietu - router</h2>
<p><img src="assets/7.anim.svg" /></p>
</section>
<section id="droga-pakietu---serwer" class="level2">
<h2>Droga pakietu - serwer</h2>
<p><img src="assets/8.anim.svg" /></p>
</section>
<section id="droga-pakietu---odebranie-pakietu" class="level2">
<h2>Droga pakietu - odebranie pakietu</h2>
<p><img src="assets/9.anim.svg" /></p>
</section>
</section>
<section id="gniazda-sieciowe-posix" class="level1">
<h1>Gniazda sieciowe POSIX</h1>
<section id="komunikacja-klienta-z-serwerem" class="level2">
<h2>Komunikacja klienta z serwerem</h2>
<p><img src="assets/communication.png" /></p>
</section>
<section id="funkcjewywołania-systemowe-po-stronie-klienta" class="level2">
<h2>Funkcje/wywołania systemowe po stronie klienta</h2>
<p>Po stronie klienta:</p>
<ul class="incremental">
<li><code>getaddrinfo()</code></li>
<li><code>socket()</code></li>
<li><code>connect()</code></li>
<li><code>read()</code></li>
<li><code>write()</code></li>
<li><code>close()</code></li>
</ul>
</section>
<section id="funkcja-getaddrinfo" class="level2">
<h2>Funkcja <code>getaddrinfo()</code></h2>
<p>Funkcja <code>getaddrinfo()</code> służy do odpytywania usługi DNS.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/types.h&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;netdb.h&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@node:</span><span class="co"> nazwa docelowa np. &quot;onet.pl&quot;</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@service:</span><span class="co"> nazwa usługi np &quot;http&quot; lub &quot;80&quot;</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@hints:</span><span class="co"> podpowiedzi</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@res:</span><span class="co"> wynik odpytania usługi DNS</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> getaddrinfo<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>node<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>service<span class="op">,</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>               <span class="dt">const</span> <span class="kw">struct</span> addrinfo <span class="op">*</span>hints<span class="op">,</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>               <span class="kw">struct</span> addrinfo <span class="op">**</span>res<span class="op">);</span></span></code></pre></div>
<p>Otrzymany wynik należy “zwolnić” za pomocą <code>freeaddrinfo()</code></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> freeaddrinfo<span class="op">(</span><span class="kw">struct</span> addrinfo <span class="op">*</span>res<span class="op">);</span></span></code></pre></div>
</section>
<section id="funkcja-getaddrinfo-przykład" class="level2">
<h2>Funkcja <code>getaddrinfo()</code> przykład</h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> addrinfo hints <span class="op">=</span> <span class="op">{</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>ai_family <span class="op">=</span> AF_INET<span class="op">,</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>ai_socktype <span class="op">=</span> SOCK_STREAM<span class="op">,</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>ai_protocol <span class="op">=</span> IPPROTO_TCP<span class="op">,</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> addrinfo <span class="op">*</span>result <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ret <span class="op">=</span> getaddrinfo<span class="op">(</span><span class="st">&quot;onet.pl&quot;</span><span class="op">,</span> <span class="st">&quot;80&quot;</span><span class="op">,</span> <span class="op">&amp;</span>hints<span class="op">,</span> <span class="op">&amp;</span>result<span class="op">);</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>ret<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Nie udało się przetłumaczyć nazwy */</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co">/* Iterujemy się po każdyn znalezionym adresie */</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="kw">struct</span> addrinfo <span class="op">*</span>i <span class="op">=</span> result<span class="op">;</span> i <span class="op">!=</span> NULL<span class="op">;</span> i <span class="op">=</span> i<span class="op">-&gt;</span>ai_next<span class="op">)</span> <span class="op">{</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> ip<span class="op">[</span>NI_MAXHOST<span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* i-&gt;ai_addr i i-&gt;ai_addrlen zawierają adres ip */</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>    getnameinfo<span class="op">(</span>i<span class="op">-&gt;</span>ai_addr<span class="op">,</span> i<span class="op">-&gt;</span>ai_addrlen<span class="op">,</span> ip<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>ip<span class="op">),</span> NULL<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> NI_NUMERICHOST<span class="op">);</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">&quot;IP serwisu onet.pl: </span><span class="sc">%s\n</span><span class="st">&quot;</span><span class="op">,</span> ip<span class="op">);</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>freeaddrinfo<span class="op">(</span>result<span class="op">);</span></span></code></pre></div>
</section>
<section id="wywołanie-systemowe-socket" class="level2">
<h2>Wywołanie systemowe <code>socket()</code></h2>
<p>Wywołanie systemowe <code>socket()</code> otwiera gniazdo sieciowe, za pomocą którego możemy komunikować się poprzez sieć.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/types.h&gt;</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@domain:</span><span class="co"> Rodzina socketu np. AF_INET, AF_INET6</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@type:</span><span class="co"> Typ socketu np. SOCK_STREAM, SOCK_DGRAM</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@protocol:</span><span class="co"> Protokół np. IPPROTO_TCP, IPPROTO_UDP</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> socket<span class="op">(</span><span class="dt">int</span> domain<span class="op">,</span> <span class="dt">int</span> type<span class="op">,</span> <span class="dt">int</span> protocol<span class="op">);</span></span></code></pre></div>
<p>Na przykład możemy utrzowyć gniazdo TCP:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd <span class="op">=</span> socket<span class="op">(</span>AF_INET<span class="op">,</span> SOCK_STREAM<span class="op">,</span> IPPROTO_TCP<span class="op">);</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>fd <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Wystąpił błąd */</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="wywołanie-systemowe-close" class="level2">
<h2>Wywołanie systemowe <code>close()</code></h2>
<p>Wywołanie systemowe <code>close()</code> zamyka gniazdo sieciowe.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> close<span class="op">(</span><span class="dt">int</span> fd<span class="op">);</span></span></code></pre></div>
<p>Przykład:</p>
<pre><code>close(fd);</code></pre>
</section>
<section id="wywołanie-systemowe-connect" class="level2">
<h2>Wywołanie systemowe <code>connect()</code></h2>
<p>Wywołanie systemowe <code>connect()</code> nawiązuje połączenie</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@socket:</span><span class="co"> gniazdo sieciowe, które chcemy połączyć</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@address:</span><span class="co"> adres, z którym chcemy się połączyć</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@address_len:</span><span class="co"> długość adresu</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> connect<span class="op">(</span><span class="dt">int</span> socket<span class="op">,</span> <span class="dt">const</span> <span class="kw">struct</span> sockaddr <span class="op">*</span>address<span class="op">,</span> socklen_t address_len<span class="op">);</span></span></code></pre></div>
<p>Można wykorzystać pola <code>ai_addr</code> i <code>ai_addrlen</code> ze struktury <code>struct addrinfo</code>, otrzymanej z <code>getaddrinfo()</code>. Przykład:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ret <span class="op">=</span> connect<span class="op">(</span>fd<span class="op">,</span> i<span class="op">-&gt;</span>ai_addr<span class="op">,</span> i<span class="op">-&gt;</span>ai_addrlen<span class="op">);</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>ret<span class="op">)</span> <span class="op">{</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Nie udało się przypisać adresu */</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="wywołanie-systemowe-read" class="level2">
<h2>Wywołanie systemowe <code>read()</code></h2>
<p>Dane z gniazda sieciowego odczytujemy podobnie jak dane z pliku:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@fd:</span><span class="co"> gniazdo siecowe</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@buf:</span><span class="co"> miejsce w pamięci gdzie zostaną zapisane odebrane dane z gniazda sieciowego</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@count:</span><span class="co"> liczba bajtów do odczytania</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> read<span class="op">(</span><span class="dt">int</span> fd<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>buf<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">);</span></span></code></pre></div>
<p>Przykład - odczytanie z gniazda do 32 bajtów:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> bytes<span class="op">[</span><span class="dv">32</span><span class="op">];</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> count <span class="op">=</span> read<span class="op">(</span>fd<span class="op">,</span> bytes<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>bytes<span class="op">));</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Zakończenie połączenia */</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>count <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Bląd */</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="wywołanie-systemowe-write" class="level2">
<h2>Wywołanie systemowe <code>write()</code></h2>
<p>Wysyłanie danych przez gniazdo sieciowe odbywa się podobnie jak zapisywanie danych do pliku.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@fd:</span><span class="co"> gniazdo sieciowe</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@buf:</span><span class="co"> miejsce w pamięci z którego zostaną wysłane dane przez gniazdo</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@count:</span><span class="co"> liczba bajtów do wysłania</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> write<span class="op">(</span><span class="dt">int</span> fd<span class="op">,</span> <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>buf<span class="op">,</span> <span class="dt">size_t</span> count<span class="op">);</span></span></code></pre></div>
<p>Przykład - wysłanie ciągu znaków <code>"Hello world"</code> przez sieć:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> text<span class="op">[]</span> <span class="op">=</span> <span class="st">&quot;Hello world&quot;</span><span class="op">;</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> count <span class="op">=</span> write<span class="op">(</span>fd<span class="op">,</span> text<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>text<span class="op">));</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>count <span class="op">!=</span> <span class="kw">sizeof</span><span class="op">(</span>text<span class="op">))</span> <span class="op">{</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Nie wszystko się udało wysłać - błąd */</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="prosty-klient-http" class="level2">
<h2>Prosty klient HTTP</h2>
<p>Zacznijmy od napisania funkcji która zwróci gniazdo połączone z serwerem http.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> connected_socket<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>addr<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>port<span class="op">)</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> addrinfo hints <span class="op">=</span> <span class="op">{</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>ai_family <span class="op">=</span> AF_INET<span class="op">,</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>ai_socktype <span class="op">=</span> SOCK_STREAM<span class="op">,</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span>ai_protocol <span class="op">=</span> IPPROTO_TCP<span class="op">,</span></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> addrinfo <span class="op">*</span>result<span class="op">;</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ret <span class="op">=</span> getaddrinfo<span class="op">(</span>addr<span class="op">,</span> port<span class="op">,</span> <span class="op">&amp;</span>hints<span class="op">,</span> <span class="op">&amp;</span>result<span class="op">);</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ret<span class="op">)</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">struct</span> addrinfo <span class="op">*</span>i <span class="op">=</span> result<span class="op">;</span> i <span class="op">!=</span> NULL<span class="op">;</span> i <span class="op">=</span> i<span class="op">-&gt;</span>ai_next<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>        fd <span class="op">=</span> socket<span class="op">(</span>i<span class="op">-&gt;</span>ai_family<span class="op">,</span> i<span class="op">-&gt;</span>ai_socktype<span class="op">,</span> i<span class="op">-&gt;</span>ai_protocol<span class="op">);</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>fd <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>        ret <span class="op">=</span> connect<span class="op">(</span>fd<span class="op">,</span> i<span class="op">-&gt;</span>ai_addr<span class="op">,</span> i<span class="op">-&gt;</span>ai_addrlen<span class="op">);</span></span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ret<span class="op">)</span> <span class="op">{</span></span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>            close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>            fd <span class="op">=</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb44-29"><a href="#cb44-29" aria-hidden="true" tabindex="-1"></a>    freeaddrinfo<span class="op">(</span>res<span class="op">);</span></span>
<span id="cb44-30"><a href="#cb44-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fd<span class="op">;</span></span>
<span id="cb44-31"><a href="#cb44-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="prosty-klient-http---żądanie-i-odpowiedź" class="level2">
<h2>Prosty klient HTTP - żądanie i odpowiedź</h2>
<div class="sourceCode" id="cb45"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/types.h&gt;</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;netdb.h&gt;</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> connected_socket<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>addr<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>port<span class="op">)</span> <span class="op">{</span> <span class="op">...</span> <span class="op">}</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd <span class="op">=</span> connected_socket<span class="op">(</span><span class="st">&quot;example.com&quot;</span><span class="op">,</span> <span class="st">&quot;80&quot;</span><span class="op">);</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fd <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> http_request<span class="op">[]</span> <span class="op">=</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;GET / HTTP/1.1</span><span class="sc">\r\n</span><span class="st">&quot;</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Host: example.com</span><span class="sc">\r\n</span><span class="st">&quot;</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;Connection: close</span><span class="sc">\r\n</span><span class="st">&quot;</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;</span><span class="sc">\r\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count <span class="op">=</span> write<span class="op">(</span>fd<span class="op">,</span> http_request<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>http_request<span class="op">));</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>count <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> buf<span class="op">[</span><span class="dv">9000</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>        count <span class="op">=</span> read<span class="op">(</span>fd<span class="op">,</span> buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>count <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">&quot;</span><span class="sc">%s</span><span class="st">&quot;</span><span class="op">,</span> buf<span class="op">);</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>    close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="prosty-klient-http---efekt" class="level2">
<h2>Prosty klient HTTP - efekt</h2>
<pre><code>$ ./a.out
HTTP/1.1 200 OK
Accept-Ranges: bytes
Age: 482357
Cache-Control: max-age=604800
Content-Type: text/html; charset=UTF-8
Date: Thu, 07 Apr 2022 19:42:28 GMT
Etag: &quot;3147526947&quot;
Expires: Thu, 14 Apr 2022 19:42:28 GMT
Last-Modified: Thu, 17 Oct 2019 07:18:26 GMT
Server: ECS (nyb/1D1B)
Vary: Accept-Encoding
X-Cache: HIT
Content-Length: 1256
Connection: close

&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Example Domain&lt;/title&gt;
    ...</code></pre>
</section>
<section id="funkcjewywołania-systemowe-po-stronie-serwera" class="level2">
<h2>Funkcje/wywołania systemowe po stronie serwera</h2>
<p>Po stronie serwera, używany jest następujący zestaw funkcji:</p>
<ul class="incremental">
<li><code>getaddrinfo()</code></li>
<li><code>socket()</code></li>
<li><code>bind()</code></li>
<li><code>listen()</code></li>
<li><code>accept()</code></li>
<li><code>read()</code></li>
<li><code>write()</code></li>
<li><code>close()</code></li>
</ul>
</section>
<section id="wywołanie-systemowe-bind" class="level2">
<h2>Wywołanie systemowe <code>bind()</code></h2>
<p>Wywołanie systemowe <code>bind()</code> przypisuje adres do gniazda sieciowego.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@socket:</span><span class="co"> gniazdo sieciowe do którego chcemy przypisać adres</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@address:</span><span class="co"> adres, który chcemy przypisać</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@address_len:</span><span class="co"> długość adresu</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> bind<span class="op">(</span><span class="dt">int</span> socket<span class="op">,</span> <span class="dt">const</span> <span class="kw">struct</span> sockaddr <span class="op">*</span>address<span class="op">,</span> socklen_t address_len<span class="op">);</span></span></code></pre></div>
<p>Można wykorzystać pola <code>ai_addr</code> i <code>ai_addrlen</code> ze struktury <code>struct addrinfo</code>, otrzymanej z <code>getaddrinfo()</code>. Przykład:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ret <span class="op">=</span> bind<span class="op">(</span>fd<span class="op">,</span> i<span class="op">-&gt;</span>ai_addr<span class="op">,</span> i<span class="op">-&gt;</span>ai_addrlen<span class="op">);</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>ret<span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Nie udało się przypisać adresu */</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="funkcja-getaddrinfo---adres-do-nasłuchiwania" class="level2">
<h2>Funkcja <code>getaddrinfo()</code> - adres do nasłuchiwania</h2>
<p>Żeby funkcja <code>getaddrinfo()</code> zwróciła nam adres na którym możemy nasłuchiwać połączeń przychodzących, musimy użyc flagi <code>AI_PASSIVE</code>:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> addrinfo hints <span class="op">=</span> <span class="op">{</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>ai_family <span class="op">=</span> AF_INET<span class="op">,</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>ai_socktype <span class="op">=</span> SOCK_STREAM<span class="op">,</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>ai_protocol <span class="op">=</span> IPPROTO_TCP<span class="op">,</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>ai_flags <span class="op">=</span> AI_PASSIVE<span class="op">,</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> addrinfo <span class="op">*</span>result <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> ret <span class="op">=</span> getaddrinfo<span class="op">(</span>NULL<span class="op">,</span> <span class="st">&quot;8080&quot;</span><span class="op">,</span> <span class="op">&amp;</span>hints<span class="op">,</span> <span class="op">&amp;</span>result<span class="op">);</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>ret<span class="op">)</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span></code></pre></div>
</section>
<section id="tworzenie-nasłuchującego-gniazda" class="level2">
<h2>Tworzenie nasłuchującego gniazda</h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd<span class="op">;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="kw">struct</span> addrinfo <span class="op">*</span>i <span class="op">=</span> result<span class="op">;</span> i <span class="op">!=</span> NULL<span class="op">;</span> i <span class="op">=</span> i<span class="op">-&gt;</span>ai_next<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    fd <span class="op">=</span> socket<span class="op">(</span>i<span class="op">-&gt;</span>ai_family<span class="op">,</span> i<span class="op">-&gt;</span>ai_socktype<span class="op">,</span> i<span class="op">-&gt;</span>ai_protocol<span class="op">);</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>fd <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    err <span class="op">=</span> bind<span class="op">(</span>fd<span class="op">,</span> i<span class="op">-&gt;</span>ai_addr<span class="op">,</span> i<span class="op">-&gt;</span>ai_addrlen<span class="op">);</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>err<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> err <span class="op">=</span> listen<span class="op">(</span>fd<span class="op">,</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>err<span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        close<span class="op">(</span>fd<span class="op">);</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>freeaddrinfo<span class="op">(</span>result<span class="op">);</span></span></code></pre></div>
</section>
<section id="wywołanie-systemowe-listen" class="level2">
<h2>Wywołanie systemowe <code>listen()</code></h2>
<p>Wywołanie systemowe <code>listen()</code> przełącza socket w tryb nasłuchiwania.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@socket:</span><span class="co"> gniazdo sieciowe</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@backlog:</span><span class="co"> maksymalny rozmiar kolejki oczekujących połączeń</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> listen<span class="op">(</span><span class="dt">int</span> socket<span class="op">,</span> <span class="dt">int</span> backlog<span class="op">);</span></span></code></pre></div>
<p>Przykładowe wywołanie:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> error <span class="op">=</span> listen<span class="op">(</span>fd<span class="op">,</span> <span class="dv">16</span><span class="op">);</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>error<span class="op">)</span> <span class="op">{</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Wystąpił błąd */</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</section>
<section id="wywołanie-systemowe-accept" class="level2">
<h2>Wywołanie systemowe <code>accept()</code></h2>
<p>Wywołanie systemowe <code>accept()</code> blokuje program do momentu połączenia się klienta. Po nawiązaniu połączenia z klientem, <code>accept()</code> odblokowywuje program i zwraca gniazdo sieciowe służące do komunikacji z klientem.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@socket:</span><span class="co"> gniazdo sieciowe nasłuchujące na połączenia</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@address:</span><span class="co"> wskaźnik do struktury w której zostanie zapisany adres klienta, NULL jeśli nas to nie interesuje</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@address_len:</span><span class="co"> wskaźnik do zmiennej, w której zostanie zapisana długość adresu, NULL jeśli nas to nie intersuje */</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> accept<span class="op">(</span><span class="dt">int</span> socket<span class="op">,</span> <span class="kw">struct</span> sockaddr <span class="op">*</span><span class="dt">restrict</span> address<span class="op">,</span> socklen_t <span class="op">*</span><span class="dt">restrict</span> address_len<span class="op">);</span></span></code></pre></div>
<p>Przykład:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> client_socket <span class="op">=</span> accept<span class="op">(</span>server_socket<span class="op">,</span> NULL<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>client_socket <span class="op">&lt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Wystąpił błąd */</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>write<span class="op">(</span>client_socket<span class="op">,</span> <span class="st">&quot;Czesc!&quot;</span><span class="op">,</span> strlen<span class="op">(</span><span class="st">&quot;Czesc&quot;</span><span class="op">)</span> <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span></code></pre></div>
</section>
</section>
<section id="dziękuję-za-uwagę" class="level1">
<h1>Dziękuję za uwagę</h1>
</section>
  <script>
    /*!	
    * FitText.js 1.0 jQuery free version
    *
    * Copyright 2011, Dave Rupert http://daverupert.com 
    * Released under the WTFPL license 
    * http://sam.zoy.org/wtfpl/
    * Modified by Slawomir Kolodziej http://slawekk.info
    *
    * Date: Tue Aug 09 2011 10:45:54 GMT+0200 (CEST)
    */
    (function(){

      var addEvent = function (el, type, fn) {
        if (el.addEventListener)
          el.addEventListener(type, fn, false);
            else
                el.attachEvent('on'+type, fn);
      };
      
      var extend = function(obj,ext){
        for(var key in ext)
          if(ext.hasOwnProperty(key))
            obj[key] = ext[key];
        return obj;
      };

      window.fitText = function (el, kompressor, options) {

        var settings = extend({
          'minFontSize' : -1/0,
          'maxFontSize' : 1/0
        },options);

        var fit = function (el) {
          var compressor = kompressor || 1;

          var resizer = function () {
            el.style.fontSize = Math.max(Math.min(el.clientWidth / (compressor*10), parseFloat(settings.maxFontSize)), parseFloat(settings.minFontSize)) + 'px';
          };

          // Call once to set.
          resizer();

          // Bind events
          // If you have any js library which support Events, replace this part
          // and remove addEvent function (or use original jQuery version)
          addEvent(window, 'resize', resizer);
          addEvent(window, 'orientationchange', resizer);
        };

        if (el.length)
          for(var i=0; i<el.length; i++)
            fit(el[i]);
        else
          fit(el);

        // return set of elements
        return el;
      };
    })();

    fitText(document.querySelectorAll('.level2'), 5);
    fitText(document.querySelectorAll('h1'), 2.5);

    document.querySelectorAll('p > img').forEach(e => e.parentNode.style.overflow="hidden");

  </script>
  </body>
</html>
