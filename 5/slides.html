<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Komunikacja sieciowa</title>
    <style>
    html { -moz-text-size-adjust: none; -webkit-text-size-adjust: none; text-size-adjust: none; }
    * { box-sizing: border-box; }
    .level2, h1 { max-height: 92vh; margin: 1em auto; background: #fff;
                  font-size: 12px; aspect-ratio: 16 / 9; padding: 1.5em;
                  display: flex; flex-direction: column; overflow: hidden;
                  flex: 1 1 auto; box-shadow: 0 0 0.5em #ddd; color: #333; }
    h1 { align-items: center; flex-direction: row; padding: 0.75em; margin: 0.5em auto;}
    body { margin: 0; padding: 0; font-family: Helvetica, sans-serif;
           background: rgb(237, 237, 240); font-size: 200px; }
    h2 { font-size: 2em; color: #005; padding: 0; }
    img { display: block; margin: auto; width: 100%; height: 100%;
          overflow: hidden; object-fit: contain;}
    section > p, section > ul { line-height: 1.5em; }
    ul { padding-left: 1em; }
    h2 { margin: 0 0 0.4em 0; }
    pre { line-height: 1.125em; }

    @page { size: 16in 9in; margin: 0; }
    @media print {
        body { -webkit-print-color-adjust: exact; }
        .level2, h1 { max-height: 100vh; margin: 0; }
    }

    .language-console .gp { color: #6ec071; }
    .sourceCode.diff .st { color: #cc6666; }
    .sourceCode.diff .va { color: #b5bd68; }

    /*

        Name:       Base16 Tomorrow Dark
        Author:     Chris Kempson (http://chriskempson.com)

        Pygments template by Jan T. Sott (https://github.com/idleberg)
        Created with Base16 Builder by Chris Kempson (https://github.com/chriskempson/base16-builder)

    */
    .sourceCode .hll { background-color: #373b41; }
    .sourceCode { background: #1d1f21; color: #ffffff; }
    .sourceCode .co { color: #969896; } /* Comment */
    .sourceCode .err { color: #cc6666; }

    /* Error */
    .sourceCode .kw { color: #b294bb; } /* Keyword */
    .sourceCode .cf { color: #b294bb; } /* Keyword */
    .sourceCode .l { color: #de935f; }

    /* Literal */
    .sourceCode .n { color: #ffffff; }

    /* Name */
    .sourceCode .ot { color: #8abeb7; } /* Operator */
    .sourceCode .op { color: #8abeb7; } /* Operator */
    .sourceCode .p { color: #ffffff; }

    /* Punctuation */
    .sourceCode .cm { color: #969896; }

    /* Comment.Multiline */
    .sourceCode .pp { color: #69AE69; } /* Comment.Preproc */
    .sourceCode .im { color: #69AE69; } /* Comment.Preproc */
    .sourceCode .c1 { color: #969896; }

    /* Comment.Single */
    .sourceCode .cs { color: #969896; }

    /* Comment.Special */
    .sourceCode .gd { color: #cc6666; }

    /* Generic.Deleted */
    .sourceCode .ge { font-style: italic; }

    /* Generic.Emph */
    .sourceCode .gh { color: #ffffff; font-weight: bold; }

    /* Generic.Heading */
    .sourceCode .gi { color: #b5bd68; }

    /* Generic.Inserted */
    .sourceCode .gp { color: #969896; font-weight: bold; }

    /* Generic.Prompt */
    .sourceCode .gs { font-weight: bold; } 
    /* Generic.Strong */
    .sourceCode .gu { color: #8abeb7; font-weight: bold; }

    /* Generic.Subheading */
    .sourceCode .kc { color: #b294bb; }

    /* Keyword.Constant */
    .sourceCode .kd { color: #b294bb; }

    /* Keyword.Declaration */
    .sourceCode .kn { color: #8abeb7; }

    /* Keyword.Namespace */
    .sourceCode .kp { color: #b294bb; }

    /* Keyword.Pseudo */
    .sourceCode .kr { color: #b294bb; }

    /* Keyword.Reserved */
    .sourceCode .dt { color: #f0c674; } /* Keyword.Type */
    .sourceCode .ld { color: #b5bd68; }

    /* Literal.Date */
    .sourceCode .m { color: #de935f; }

    /* Literal.Number */
    .sourceCode .s { color: #b5bd68; }

    /* Literal.String */
    .sourceCode .na { color: #81a2be; }

    /* Name.Attribute */
    .sourceCode .bu { color: #ffffff; } /* Name.Builtin */
    .sourceCode .nc { color: #f0c674; }

    /* Name.Class */
    .sourceCode .no { color: #cc6666; }

    /* Name.Constant */
    .sourceCode .nd { color: #8abeb7; }

    /* Name.Decorator */
    .sourceCode .ni { color: #ffffff; }

    /* Name.Entity */
    .sourceCode .ne { color: #cc6666; }

    /* Name.Exception */
    .sourceCode .fu { color: #81a2be; } /* Name.Function */

    /* Name.Label */
    .sourceCode .nn { color: #f0c674; }

    /* Name.Namespace */
    .sourceCode .nx { color: #81a2be; }

    /* Name.Other */
    .sourceCode .py { color: #ffffff; }

    /* Name.Property */
    .sourceCode .nt { color: #8abeb7; }

    /* Name.Tag */
    .sourceCode .va { color: #cc6666; } /* Name.Variable */
    .sourceCode .ow { color: #8abeb7; }

    /* Operator.Word */
    .sourceCode .w { color: #ffffff; }

    /* Text.Whitespace */
    .sourceCode .mf { color: #de935f; }

    /* Literal.Number.Float */
    .sourceCode .mh { color: #de935f; }

    /* Literal.Number.Hex */
    .sourceCode .dv { color: #de935f; }
    .sourceCode .er { color: #de935f; }

    /* Literal.Number.Integer */
    .sourceCode .mo { color: #de935f; }

    /* Literal.Number.Oct */
    .sourceCode .sb { color: #b5bd68; }

    /* Literal.String.Backtick */
    .sourceCode .sc { color: #ffffff; }

    /* Literal.String.Char */
    .sourceCode .sd { color: #969896; }

    /* x Literal.String.Doc */
    .sourceCode .st { color: #b5bd68; }

    /* Literal.String.Double */
    .sourceCode .sc { color: #de935f; } 
    /* Literal.String.Escape */
    .sourceCode .sh { color: #b5bd68; }

    /* Literal.String.Heredoc */
    .sourceCode .si { color: #de935f; }

    /* Literal.String.Interpol */
    .sourceCode .sx { color: #b5bd68; }

    /* Literal.String.Other */
    .sourceCode .sr { color: #b5bd68; }

    /* Literal.String.Regex */
    .sourceCode .s1 { color: #b5bd68; }

    /* Literal.String.Single */
    .sourceCode .ss { color: #b5bd68; }

    /* Literal.String.Symbol */
    .sourceCode .bp { color: #ffffff; }

    /* Name.Builtin.Pseudo */
    .sourceCode .vc { color: #cc6666; }

    /* Name.Variable.Class */
    .sourceCode .vg { color: #cc6666; }

    /* Name.Variable.Global */
    .sourceCode .vi { color: #cc6666; }

    /* Name.Variable.Instance */
    .sourceCode .il { color: #de935f; }

    /* Literal.Number.Integer.Long */

    div.sourceCode { vertical-align: top; }

    pre { font-family: monospace; font-size: 0.8em; }

    .sourceCode a { color: #fff }

    .sourceCode pre { padding: 0; margin: 0; }

    pre code { display: block; padding: 1em 1.25em; overflow-x: auto; background: #1d1f21; color: #ffffff; }

    .sourceCode pre code::-webkit-scrollbar { -webkit-appearance: none; }
    .sourceCode pre code::-webkit-scrollbar:vertical { width: 10px; }
    .sourceCode pre code::-webkit-scrollbar:horizontal { height: 10px; }
    .sourceCode pre code::-webkit-scrollbar-thumb { background-color: #555; }
    .sourceCode pre code::-webkit-scrollbar-track { background-color: #333; }
    .sourceCode::selection { background: #fff; /* WebKit/Blink Browsers */ color: #000; }
    .sourceCode::-moz-selection { background: #fff; /* Gecko Browsers */ color: #000; }
    p > code, li > code { background: #fff; padding: 0.1em 0.2em; box-shadow: 0 2px 4px 0 #ddd; border: 1px solid #ddd; }

    div.sourceCode, pre, section > p, section > ul { margin: 0 0 0.7em 0; }

    </style>
    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body>
<section id="zagadnienie-5-gniazda" class="level1"><h1>Zagadnienie 5: Gniazda</h1><section id="gniazda" class="level2"><h2>Gniazda</h2><p>Gniazda pozwalają na komunikację pomiędzy procesami działającymi na tej samej maszynie oraz działającymi na różnych maszynach.</p><p>Systemy uniksowe oferują wiele różnych typów gniazd, jednak ustandaryzowane przez POSIX są:</p><ul class="incremental"><li>gniazda lokalne (ang. Unix domain sockets), <code>AF_UNIX</code>;</li><li>gniazda sieciowe (ang. network sockets), <code>AF_INET</code> i <code>AF_INET6</code>.</li></ul></section><section id="gniazda---tworzenie" class="level2"><h2>Gniazda - tworzenie</h2><p>Do tworzenia gniazd sieciowych służy wywołanie systemowe <code>socket()</code>.</p><div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> socket(<span class="dt">int</span> domain, <span class="dt">int</span> type, <span class="dt">int</span> protocol);</span></code></pre></div><div class="sourceCode" id="cb2"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> fd = -<span class="dv">1</span>;</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">/* Lokalny, niezawodny, połączeniowy strumień danych */</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>fd = socket(AF_UNIX, SOCK_STREAM, <span class="dv">0</span>);</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">/* Lokalne, zawodne, bezpołączeniowe wiadomości */</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>fd = socket(AF_UNIX, SOCK_DGRAM, <span class="dv">0</span>);</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">/* Lokalne, niezawodne, połączeniowe wiadomości */</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>fd = socket(AF_UNIX, SOCK_SEQPACKET, <span class="dv">0</span>);</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sieciowy, IPv4, niezawodny, połączeniowy strumień danych oparty o protokół TCP */</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>fd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sieciowe, IPv4, zawodne, bezpołączeniowe wiadomości oparte o protokół UDP */</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>fd = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sieciowe, IPv4, niezawodne, połączeniowe wiadomości oparte o protokół SCTP */</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>fd = socket(AF_INET, SOCK_SEQPACKET, IPPROTO_SCTP);</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sieciowy, IPv6, niezawodny, połączeniowy strumień danych oparty o protokół TCP */</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>fd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sieciowe, IPv6, zawodne, bezpołączeniowe wiadomości oparte o protokół UDP */</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>fd = socket(AF_INET, SOCK_DGRAM, IPPROTO_UDP);</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">/* Sieciowe, IPv6, niezawodne, połączeniowe wiadomości oparte o protokół SCTP */</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>fd = socket(AF_INET, SOCK_SEQPACKET, IPPROTO_SCTP);</span></code></pre></div></section><section id="gniazda-1" class="level2"><h2>Gniazda</h2><p>Do operacji na gniazdach służy następujący zestaw wywołań systemowych:</p><div class="sourceCode" id="cb3"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/types.h&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co">/* Po obu stronach */</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> socket(<span class="dt">int</span> domain, <span class="dt">int</span> type, <span class="dt">int</span> protocol);</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co">/* Po stronie klienta */</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> connect(<span class="dt">int</span> socket, <span class="dt">const</span> <span class="kw">struct</span> sockaddr *address, socklen_t address_len);</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co">/* Po strinie serwera */</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> bind(<span class="dt">int</span> socket, <span class="dt">const</span> <span class="kw">struct</span> sockaddr *address, socklen_t address_len);</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> listen(<span class="dt">int</span> socket, <span class="dt">int</span> backlog);</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> accept(<span class="dt">int</span> socket, <span class="kw">struct</span> sockaddr *<span class="dt">restrict</span> address, socklen_t *<span class="dt">restrict</span> address_len);</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">/* Po obu stronach */</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> read(<span class="dt">int</span> fd, <span class="dt">void</span> *data, <span class="dt">size_t</span> count);</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span> write(<span class="dt">int</span> fd, <span class="dt">const</span> <span class="dt">void</span> *data, <span class="dt">size_t</span> count);</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> close(<span class="dt">int</span> fd);</span></code></pre></div></section><section id="gniazda-lokalne---struktura-adresu" class="level2"><h2>Gniazda lokalne - struktura adresu</h2><div class="sourceCode" id="cb4"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/un.h&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> sockaddr_un {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    sa_family_t sun_family;               <span class="co">/* AF_UNIX */</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>        sun_path[<span class="dv">108</span>];            <span class="co">/* Ścieżka */</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>};</span></code></pre></div></section><section id="gniazda-sieciowe---struktura-adresu" class="level2"><h2>Gniazda sieciowe - struktura adresu</h2><div class="sourceCode" id="cb5"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;netinet/in.h&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> sockaddr_in {</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span>            sin_family;   <span class="co">// e.g. AF_INET</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">short</span>   sin_port;     <span class="co">// e.g. htons(3490)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> in_addr   sin_addr;     <span class="co">// see struct in_addr, below</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span>             sin_zero[<span class="dv">8</span>];  <span class="co">// zero this if you want to</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>};</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> in_addr {</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> s_addr;  <span class="co">// load with inet_aton()</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>};</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> sockaddr_in6 {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    sa_family_t     sin6_family;   <span class="co">/* AF_INET6 */</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>    in_port_t       sin6_port;     <span class="co">/* port number */</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span>        sin6_flowinfo; <span class="co">/* IPv6 flow information */</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> in6_addr sin6_addr;     <span class="co">/* IPv6 address */</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">uint32_t</span>        sin6_scope_id; <span class="co">/* Scope ID (new in Linux 2.4) */</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>};</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> in6_addr {</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span>   s6_addr[<span class="dv">16</span>];   <span class="co">/* IPv6 address */</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>};</span></code></pre></div></section><section id="komunikacja-klienta-z-serwerem" class="level2"><h2>Komunikacja klienta z serwerem</h2><p><img src="assets/communication.png" /></p></section><section id="przesyłanie-danych-przez-gniazda" class="level2"><h2>Przesyłanie danych przez gniazda</h2><p>Oprócz <code>read()</code> i <code>write()</code> można wykorzystać też <code>recv()</code> lub <code>recvfrom()</code> oraz <code>send()</code> lub <code>sendto()</code>.</p><div class="sourceCode" id="cb6"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>recv(<span class="dt">int</span> socket, <span class="dt">void</span> *buffer, <span class="dt">size_t</span> length, <span class="dt">int</span> flags);</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>send(<span class="dt">int</span> socket, <span class="dt">const</span> <span class="dt">void</span> *buffer, <span class="dt">size_t</span> length, <span class="dt">int</span> flags);</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>recvfrom(<span class="dt">int</span> socket, <span class="dt">void</span> *<span class="dt">restrict</span> buffer, <span class="dt">size_t</span> length, <span class="dt">int</span> flags,</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a> <span class="kw">struct</span> sockaddr *<span class="dt">restrict</span> address, socklen_t *<span class="dt">restrict</span> address_len);</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="dt">ssize_t</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>sendto(<span class="dt">int</span> socket, <span class="dt">const</span> <span class="dt">void</span> *buffer, <span class="dt">size_t</span> length, <span class="dt">int</span> flags,</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a> <span class="dt">const</span> <span class="kw">struct</span> sockaddr *dest_addr, socklen_t dest_len);</span></code></pre></div></section><section id="gniazda-lokalne---serwer" class="level2"><h2>Gniazda lokalne - serwer</h2><div class="sourceCode" id="cb7"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = socket(AF_UNIX, SOCK_STREAM, <span class="dv">0</span>);</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    unlink(addr.sun_path);</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="kw">struct</span> sockaddr_un addr = {</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        .sun_family = AF_UNIX, .sun_path = <span class="st">&quot;foo&quot;</span>,</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    };</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (bind(fd, (<span class="dt">const</span> <span class="kw">struct</span> sockaddr *)&amp;addr, <span class="kw">sizeof</span>(addr)))</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (listen(fd, <span class="dv">8</span>))</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (<span class="dv">1</span>) {</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> client_fd = accept(fd, NULL, NULL);</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (client_fd &lt; <span class="dv">0</span>)</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span>;</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> msg[<span class="dv">256</span>] = {<span class="dv">0</span>};</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ssize_t</span> num_read = read(client_fd, msg, <span class="kw">sizeof</span>(msg) - <span class="dv">1</span>);</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (num_read)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            printf(<span class="st">&quot;%s</span><span class="sc">\n</span><span class="st">&quot;</span>, msg);</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        close(client_fd);</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>err_close:</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    close(fd);</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>    unlink(addr.sun_path);</span></code></pre></div></section><section id="gniazda-lokalne---klient" class="level2"><h2>Gniazda lokalne - klient</h2><div class="sourceCode" id="cb8"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = socket(AF_UNIX, SOCK_STREAM, <span class="dv">0</span>);</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="kw">struct</span> sockaddr_un addr = {</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        .sun_family = AF_UNIX,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        .sun_path = <span class="st">&quot;foo&quot;</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    };</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> err = connect(fd, (<span class="dt">const</span> <span class="kw">struct</span> sockaddr *)&amp;addr, <span class="kw">sizeof</span>(addr));</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (err)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ssize_t</span> num_written = write(fd, <span class="st">&quot;Hello world&quot;</span>, strlen(<span class="st">&quot;Hello world&quot;</span>));</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (num_written &lt;= <span class="dv">0</span>) {</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* error */</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>err_close:</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    close(fd);</span></code></pre></div></section><section id="gniazda-sieciowe---serwer" class="level2"><h2>Gniazda sieciowe - serwer</h2><div class="sourceCode" id="cb9"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;netinet/in.h&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="kw">struct</span> sockaddr_in addr = {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        .sin_family = AF_INET,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>        .sin_port = htons(<span class="dv">2000</span>),</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    };</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (bind(fd, (<span class="dt">const</span> <span class="kw">struct</span> sockaddr *)&amp;addr, <span class="kw">sizeof</span>(addr)))</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    ...</span></code></pre></div></section><section id="gniazda-sieciowe---klient" class="level2"><h2>Gniazda sieciowe - klient</h2><div class="sourceCode" id="cb10"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#include </span><span class="im">&lt;netinet/in.h&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = socket(AF_INET, SOCK_STREAM, IPPROTO_TCP);</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> sockaddr_in addr = {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        .sin_family = AF_INET,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        .sin_port = htons(<span class="dv">2000</span>),</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    };</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!inet_aton(<span class="st">&quot;127.0.0.1&quot;</span>, &amp;addr.sin_addr))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> err = connect(fd, (<span class="dt">const</span> <span class="kw">struct</span> sockaddr *)&amp;addr, <span class="kw">sizeof</span>(addr));</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (err)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    ...</span></code></pre></div></section></section><section id="protokół-http" class="level1"><h1>Protokół HTTP</h1><section id="każda-strona-internetowa-to-dokument-hipertekstowy" class="level2"><h2>Każda strona internetowa to dokument hipertekstowy</h2><p><img src="assets/onet.png" /></p></section><section id="hipertekstowy-język-znaczników-html" class="level2"><h2>Hipertekstowy język znaczników (HTML)</h2><p>Język HTML, służy do formułowania dokumentów hipertekstowych, które następnie są prezentowane przez przeglądarke jako strona internetowa.</p><div class="sourceCode" id="cb11"><pre class="sourceCode html"><code class="sourceCode html"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!doctype </span>html<span class="dt">&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;html</span><span class="ot"> lang=</span><span class="st">&quot;pl&quot;</span><span class="kw">&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;head&gt;</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span><span class="ot"> charset=</span><span class="st">&quot;utf-8&quot;</span><span class="kw">&gt;</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span><span class="ot"> http-equiv=</span><span class="st">&quot;X-UA-Compatible&quot;</span><span class="ot"> content=</span><span class="st">&quot;IE=edge&quot;</span><span class="kw">&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;meta</span><span class="ot"> name=</span><span class="st">&quot;viewport&quot;</span><span class="ot"> content=</span><span class="st">&quot;width=device-width, initial-scale=1&quot;</span><span class="kw">&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;title&gt;</span>Title<span class="kw">&lt;/title&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/head&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;body&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;h1&gt;</span>Witaj świecie<span class="kw">&lt;/h1&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">&lt;p&gt;</span>Oto pierwszy akapit<span class="kw">&lt;/p&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">&lt;/body&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="kw">&lt;/html&gt;</span></span></code></pre></div></section><section id="hipertekstowy-język-znaczników---efekt" class="level2"><h2>Hipertekstowy język znaczników - efekt</h2><p>Po wyrenderowaniu HTML, przez przeglądarke otrzymujemy następujący efekt:</p><p><img src="assets/htmlhello.png" /></p></section><section id="protokół-przesyłania-dokumentów-hipertekstowych-http" class="level2"><h2>Protokół przesyłania dokumentów hipertekstowych (HTTP)</h2><p>Do przesyłania dokumentów HTML poprzez sieć służy protokół HTTP. Gdy użytkownik chce wejśc na daną stronę internetową, to przeglądarka wysyła żądanie HTTP do serwera HTTP. Następnie serwer odsyła przeglądarce odpowiedź.</p><p><img src="assets/http.svg" /></p></section><section id="żądanie-http" class="level2"><h2>Żądanie HTTP</h2><p>Żądanie HTTP ma format tekstowy. Składa się z nagłówków zapytania oraz opcjonalnego ciała.</p><pre><code>METODA ZASÓB WERSJA_HTTP
Nagłówek1: Wartość1
Nagłówek2: Wartość2

&lt;opcjonalne ciało&gt;</code></pre><p>Przykład:</p><pre><code>GET /index.html HTTP/1.1
Host: example.com
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:98.0) Gecko/20100101 Firefox/98.0
Accept: */*

</code></pre><p>W <code>HTTP/1.1</code> wymaganym nagłówkiem jest <code>Host</code>, reszta jest opcjonalna.</p></section><section id="odpowiedź-http" class="level2"><h2>Odpowiedź HTTP</h2><p>Odpowiedź HTTP ma format tekstowy. Składa się z linii statusu, nagłówków zapytania oraz opcjonalnego ciała:</p><pre><code>HTTP/1.1 KOD_ODPOWIEDZI NAZWA_KODU
Nagłówek1: Wartość1
Nagłówek2: Wartość2

&lt;opcjonalne ciało&gt;</code></pre></section><section id="odpowiedź-http---przykład" class="level2"><h2>Odpowiedź HTTP - przykład</h2><p>Przykładowa odpowiedź HTTP:</p><pre><code>HTTP/1.1 200 OK
Content-Type: text/html; charset=UTF-8
Date: Thu, 07 Apr 2022 15:32:42 GMT
Content-Length: 353

&lt;!doctype html&gt;
&lt;html lang=&quot;pl&quot;&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;utf-8&quot;&gt;
        &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
        &lt;title&gt;Title&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Witaj świecie&lt;/h1&gt;
        &lt;p&gt;Oto pierwszy akapit&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre></section><section id="prosty-klient-http" class="level2"><h2>Prosty klient HTTP</h2><p>Zacznijmy od napisania funkcji która zwróci gniazdo połączone z serwerem http.</p><div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;netinet/in.h&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;arpa/inet.h&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> connected_socket(<span class="dt">const</span> <span class="dt">char</span> *ip, <span class="dt">unsigned</span> <span class="dt">short</span> port)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = socket(AF_INET, SOCK_STREAM, <span class="dv">0</span>);</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> -<span class="dv">1</span>;</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> sockaddr_in addr = {</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>        .sin_family = AF_INET,</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>        .sin_port = htons(port),</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    };</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!inet_aton(ip, &amp;addr.sin_addr))</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (connect(fd, (<span class="dt">const</span> <span class="kw">struct</span> sockaddr *)&amp;addr, <span class="kw">sizeof</span>(addr)))</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> fd;</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>err_close:</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    close(fd);</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> -<span class="dv">1</span>;</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></section><section id="prosty-klient-http---treść-żądania" class="level2"><h2>Prosty klient HTTP - treść żądania</h2><div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> connected_socket(<span class="dt">const</span> <span class="dt">char</span> *addr, <span class="dt">const</span> <span class="dt">char</span> *port) { ... }</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">const</span> <span class="dt">char</span> *http_request =</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;GET / HTTP/1.1</span><span class="sc">\r\n</span><span class="st">&quot;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Host: example.com</span><span class="sc">\r\n</span><span class="st">&quot;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Connection: close</span><span class="sc">\r\n</span><span class="st">&quot;</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;</span><span class="sc">\r\n</span><span class="st">&quot;</span>;</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>) { ... }</span></code></pre></div></section><section id="prosty-klient-http---wysyłanie-żądania" class="level2"><h2>Prosty klient HTTP - wysyłanie żądania</h2><div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;errno.h&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> write_all(<span class="dt">int</span> fd, <span class="dt">const</span> <span class="dt">void</span> *buf, <span class="dt">size_t</span> len)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> *bytes = buf;</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> remaining = len;</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Jeżeli jest jeszcze coś do wpisania */</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (remaining) {</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Wpisz ile się da */</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ssize_t</span> num_written = write(fd, bytes, remaining);</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (num_written &lt;= <span class="dv">0</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> errno;</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Zauktualizuj ile jeszcze mamy wpisać */</span></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>        remaining -= (<span class="dt">size_t</span>)num_written;</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Przesuń wskaźnik do jeszcze nie wpisanych danych */</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>        bytes += (<span class="dt">size_t</span>)num_written;</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></section><section id="prosty-klient-http---odbieranie-odpowiedzi" class="level2"><h2>Prosty klient HTTP - odbieranie odpowiedzi</h2><div class="sourceCode" id="cb19"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> read_all(<span class="dt">int</span> fd, <span class="dt">void</span> *buf, <span class="dt">size_t</span> len)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ret = <span class="dv">0</span>;</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> *bytes = buf;</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> remaining = len;</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (<span class="dv">1</span>) {</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Odczytaj blok danych */</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> buf[<span class="dv">1024</span>];</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ssize_t</span> num_read = read(fd, buf, <span class="kw">sizeof</span>(buf));</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (num_read &lt; <span class="dv">0</span>)</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> errno;</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (num_read == <span class="dv">0</span>)</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span>;</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Oceń czy można skopiować cały blok, czy tylko tyle ile sie zmieści */</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">size_t</span> to_copy = remaining &lt; num_read ? remaining : num_read;</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (!to_copy) {</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>            ret = ENOBUFS;</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span>;</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Skopiuj odczytany kawałek do bufora */</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>        memcpy(bytes, buf, to_copy);</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>        remaining -= to_copy;</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>        bytes += to_copy;</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret;</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></section><section id="prosty-klient-http---żądanie-i-odpowiedź" class="level2"><h2>Prosty klient HTTP - żądanie i odpowiedź</h2><div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/types.h&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sys/socket.h&gt;</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unistd.h&gt;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> connected_socket(<span class="dt">const</span> <span class="dt">char</span> *addr, <span class="dt">const</span> <span class="dt">char</span> *port) { ... }</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> read_all(<span class="dt">int</span> fd, <span class="dt">void</span> *buf, <span class="dt">size_t</span> len) { ... }</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> write_all(<span class="dt">int</span> fd, <span class="dt">const</span> <span class="dt">void</span> *buf, <span class="dt">size_t</span> len) { ... }</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">const</span> <span class="dt">char</span> *http_request = ...</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = connected_socket(<span class="st">&quot;93.184.216.34&quot;</span>, <span class="dv">80</span>);</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (write_all(fd, http_request, strlen(http_request)))</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close_fd;</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> response[<span class="dv">9000</span>] = {<span class="dv">0</span>};</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (read_all(fd, response, <span class="kw">sizeof</span>(response) - <span class="dv">1</span>));</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close_fr;</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>    printf(<span class="st">&quot;%s&quot;</span>, buf);</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>err_close_fd:</span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>    close(fd);</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></section><section id="prosty-klient-http---efekt" class="level2"><h2>Prosty klient HTTP - efekt</h2><pre><code>$ ./a.out
HTTP/1.1 200 OK
Accept-Ranges: bytes
Age: 482357
Cache-Control: max-age=604800
Content-Type: text/html; charset=UTF-8
Date: Thu, 07 Apr 2022 19:42:28 GMT
Etag: &quot;3147526947&quot;
Expires: Thu, 14 Apr 2022 19:42:28 GMT
Last-Modified: Thu, 17 Oct 2019 07:18:26 GMT
Server: ECS (nyb/1D1B)
Vary: Accept-Encoding
X-Cache: HIT
Content-Length: 1256
Connection: close

&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Example Domain&lt;/title&gt;
    ...</code></pre></section><section id="prosty-klient-https---ssl" class="level2"><h2>Prosty klient HTTPS - SSL</h2><div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include</span><span class="im">&lt;openssl/ssl.h&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    SSL_CTX* ctx = SSL_CTX_new(SSLv23_client_method());</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!ctx)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = connected_socket(<span class="st">&quot;93.184.216.34&quot;</span>, <span class="dv">80</span>);</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_ssl_ctx_free;</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>err_ssl_ctx_free:</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>    SSL_CTX_free(ctx);</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></section><section id="prosty-klient-https---ssl-1" class="level2"><h2>Prosty klient HTTPS - SSL</h2><div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    SSL_CTX* ctx = SSL_CTX_new(SSLv23_client_method());</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!ctx)</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = connected_socket(<span class="st">&quot;93.184.216.34&quot;</span>, <span class="dv">80</span>);</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_ssl_ctx_free;</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    SSL* ssl = SSL_new(ctx);</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!ssl)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (SSL_set_fd(ssl, fd) != <span class="dv">1</span> || SSL_connect(ssl) != <span class="dv">1</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_free_ssl;</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>err_free_ssl</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    SSL_free(ssl);</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>err_close_fd:</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    close(fd);</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>err_ssl_ctx_free:</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    SSL_CTX_free(ctx);</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></section><section id="prosty-klient-https---wysyłanie-żądania" class="level2"><h2>Prosty klient HTTPS - wysyłanie żądania</h2><div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> write_all(SSL *ssl, <span class="dt">const</span> <span class="dt">void</span> *buf, <span class="dt">size_t</span> len)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> *bytes = buf;</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> remaining = (<span class="dt">int</span>)len;</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">/* Jeżeli jest jeszcze coś do wpisania */</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (remaining) {</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Wpisz ile się da */</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> num_written = SSL_write(ssl, bytes, remaining);</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (num_written &lt;= <span class="dv">0</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Zauktualizuj ile jeszcze mamy wpisać */</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        remaining -= num_written;</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Przesuń wskaźnik do jeszcze nie wpisanych danych */</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>        bytes += num_written;</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></section><section id="prosty-klient-https---odbieranie-odpowiedzi" class="level2"><h2>Prosty klient HTTPS - odbieranie odpowiedzi</h2><div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>...</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> read_all(SSL *ssl, <span class="dt">void</span> *buf, <span class="dt">size_t</span> len)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> ret = <span class="dv">0</span>;</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> *bytes = buf;</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> remaining = (<span class="dt">int</span>)len;</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (<span class="dv">1</span>) {</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Odczytaj blok danych */</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">char</span> buf[<span class="dv">1024</span>];</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> num_read = SSL_read(ssl, buf, <span class="kw">sizeof</span>(buf));</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (num_read &lt; <span class="dv">0</span>)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> errno;</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (num_read == <span class="dv">0</span>)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span>;</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Oceń czy można skopiować cały blok, czy tylko tyle ile sie zmieści */</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> to_copy = remaining &lt; num_read ? remaining : num_read;</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (!to_copy) {</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>            ret = ENOBUFS;</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span>;</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="co">/* Skopiuj odczytany kawałek do bufora */</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        memcpy(bytes, buf, to_copy);</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>        remaining -= to_copy;</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>        bytes += to_copy;</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ret;</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></section><section id="prosty-klient-https---żądanie-i-odpowiedź" class="level2"><h2>Prosty klient HTTPS - żądanie i odpowiedź</h2><div class="sourceCode" id="cb26"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main(<span class="dt">void</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    SSL_CTX* ctx = SSL_CTX_new(SSLv23_client_method());</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!ctx)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="dv">1</span>;</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> fd = connected_socket(<span class="st">&quot;93.184.216.34&quot;</span>, <span class="dv">80</span>);</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (fd &lt; <span class="dv">0</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_ssl_ctx_free;</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    SSL* ssl = SSL_new(ctx);</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (!ssl)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_close;</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (SSL_set_fd(ssl, fd) != <span class="dv">1</span> || SSL_connect(ssl) != <span class="dv">1</span>)</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_free_ssl;</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (write_all(ssl, http_request, strlen(http_request)))</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_free_ssl;</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> response[<span class="dv">9000</span>] = {<span class="dv">0</span>};</span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (read_all(ssl, response, <span class="kw">sizeof</span>(response) - <span class="dv">1</span>));</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> err_free_ssl;</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>err_free_ssl</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    SSL_free(ssl);</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>err_close_fd:</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>    close(fd);</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>err_ssl_ctx_free:</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>    SSL_CTX_free(ctx);</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div></section></section><section id="dziękuję-za-uwagę" class="level1"><h1>Dziękuję za uwagę</h1></section>
  <script>
    /*!	
    * FitText.js 1.0 jQuery free version
    *
    * Copyright 2011, Dave Rupert http://daverupert.com 
    * Released under the WTFPL license 
    * http://sam.zoy.org/wtfpl/
    * Modified by Slawomir Kolodziej http://slawekk.info
    *
    * Date: Tue Aug 09 2011 10:45:54 GMT+0200 (CEST)
    */
    (function(){

      var addEvent = function (el, type, fn) {
        if (el.addEventListener)
          el.addEventListener(type, fn, false);
            else
                el.attachEvent('on'+type, fn);
      };
      
      var extend = function(obj,ext){
        for(var key in ext)
          if(ext.hasOwnProperty(key))
            obj[key] = ext[key];
        return obj;
      };

      window.fitText = function (el, kompressor, options) {

        var settings = extend({
          'minFontSize' : -1/0,
          'maxFontSize' : 1/0
        },options);

        var fit = function (el) {
          var compressor = kompressor || 1;

          var resizer = function () {
            el.style.fontSize = Math.max(Math.min(el.clientWidth / (compressor*10), parseFloat(settings.maxFontSize)), parseFloat(settings.minFontSize)) + 'px';
          };

          // Call once to set.
          resizer();

          // Bind events
          // If you have any js library which support Events, replace this part
          // and remove addEvent function (or use original jQuery version)
          addEvent(window, 'resize', resizer);
          addEvent(window, 'orientationchange', resizer);
        };

        if (el.length)
          for(var i=0; i<el.length; i++)
            fit(el[i]);
        else
          fit(el);

        // return set of elements
        return el;
      };
    })();

    fitText(document.querySelectorAll('.level2'), 5);
    fitText(document.querySelectorAll('h1'), 2.5);

    document.querySelectorAll('p > img').forEach(e => e.parentNode.style.overflow="hidden");

  </script>
  </body>
</html>
